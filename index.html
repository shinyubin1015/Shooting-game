<!doctype html>
<html lang="ko" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tactical Strike FPS</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Rajdhani', 'Orbitron', sans-serif;
      cursor: crosshair;
    }
    
    * {
      box-sizing: border-box;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    @keyframes hitmarker {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
    }

    .hitmarker {
      animation: hitmarker 0.3s ease-out forwards;
    }

    @keyframes damageFlash {
      0%, 100% { opacity: 0; }
      50% { opacity: 0.3; }
    }

    .damage-flash {
      animation: damageFlash 0.2s ease-out;
    }
    
    @keyframes explosion {
      0% { transform: scale(0); opacity: 1; }
      50% { opacity: 1; }
      100% { transform: scale(1.5); opacity: 0; }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full w-full">
  <div id="app-wrapper" class="h-full w-full relative"><!-- Game Canvas -->
   <canvas id="gameCanvas" class="w-full h-full block"></canvas><!-- Damage Flash Effect -->
   <div id="damageFlash" class="absolute inset-0 bg-red-600 pointer-events-none" style="opacity: 0; z-index: 5;"></div><!-- HUD Overlay -->
   <div id="hud" class="absolute top-0 left-0 w-full h-full pointer-events-none" style="z-index: 10;"><!-- Top Left - Game Title & Pause Button -->
    <div class="absolute top-2 left-2 flex gap-2">
     <div class="bg-black bg-opacity-80 px-3 py-2 rounded-lg border border-cyan-400" style="backdrop-filter: blur(10px);">
      <div class="text-cyan-400 text-sm font-bold tracking-wider" id="gameTitle">
       TACTICAL STRIKE
      </div>
     </div><button id="pauseBtn" class="pointer-events-auto cursor-pointer bg-black bg-opacity-80 px-3 py-2 rounded-lg border border-yellow-400 hover:bg-yellow-400 hover:bg-opacity-20 transition-all" style="backdrop-filter: blur(10px);">
      <div class="text-yellow-400 text-sm font-bold">
       â¸ ì¼ì‹œì •ì§€
      </div></button>
    </div><!-- Top Right - Score & Kills -->
    <div class="absolute top-2 right-2">
     <div class="bg-black bg-opacity-80 px-3 py-1 rounded-lg border border-yellow-400 text-center mb-1" style="backdrop-filter: blur(10px);">
      <div class="text-yellow-400 text-xs tracking-wider">
       ğŸ’° ì½”ì¸
      </div>
      <div class="text-white text-xl font-bold" id="coinDisplay">
       0
      </div>
     </div>
     <div class="bg-black bg-opacity-80 px-3 py-1 rounded-lg border border-orange-400 text-center mb-1" style="backdrop-filter: blur(10px);">
      <div class="text-orange-400 text-xs tracking-wider">
       ì²˜ì¹˜
      </div>
      <div class="text-white text-2xl font-bold" id="killCount">
       0
      </div>
     </div>
     <div class="bg-black bg-opacity-80 px-3 py-1 rounded-lg border border-green-400 text-center" style="backdrop-filter: blur(10px);">
      <div class="text-green-400 text-xs tracking-wider">
       ë ˆë²¨
      </div>
      <div class="text-white text-2xl font-bold" id="levelDisplay">
       1
      </div>
     </div>
    </div><!-- Bottom Left - Controls -->
    <div class="absolute bottom-2 left-2">
     <div class="bg-black bg-opacity-80 px-2 py-1 rounded-lg border border-gray-600 text-gray-300 text-xs tracking-wider" id="controlsText">
      WASD: ì´ë™ | ë§ˆìš°ìŠ¤: ì¡°ì¤€ | í´ë¦­: ë°œì‚¬ | R: ì¬ì¥ì „
     </div>
    </div><!-- Bottom Center - Weapon Info & Health -->
    <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2">
     <div class="bg-black bg-opacity-90 px-4 py-3 rounded-lg border border-purple-500" style="backdrop-filter: blur(10px);"><!-- Health Bar -->
      <div class="flex items-center justify-center gap-2 mb-2 pb-2 border-b border-gray-700">
       <div class="text-cyan-400 text-xs tracking-wider">
        HP
       </div>
       <div class="text-white text-xl font-bold" id="healthDisplay">
        100
       </div>
       <div id="healthBar" class="w-32 h-2.5 bg-gray-700 rounded-full overflow-hidden">
        <div id="healthFill" class="h-full bg-gradient-to-r from-cyan-400 to-cyan-600 transition-all duration-300" style="width: 100%;"></div>
       </div>
      </div><!-- Weapon Info -->
      <div class="text-center">
       <div class="text-purple-400 text-xs tracking-widest mb-1" id="weaponName">
        AR-47 PHANTOM
       </div>
       <div class="flex items-baseline justify-center gap-1"><span class="text-white text-2xl font-bold" id="currentAmmo">30</span> <span class="text-gray-500 text-lg font-bold">/</span> <span class="text-gray-400 text-xl font-bold" id="reserveAmmo">120</span>
       </div>
      </div>
      <div id="reloadText" class="text-yellow-400 text-xs text-center tracking-wider hidden">
       ì¬ì¥ì „ ì¤‘...
      </div>
     </div>
    </div><!-- Crosshair -->
    <div id="crosshair" class="absolute pointer-events-none" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
     <div class="relative w-6 h-6">
      <div class="absolute bg-cyan-400 shadow-lg" style="width: 8px; height: 1px; left: 50%; top: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 6px rgba(34, 211, 238, 0.8);"></div>
      <div class="absolute bg-cyan-400 shadow-lg" style="width: 1px; height: 8px; left: 50%; top: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 6px rgba(34, 211, 238, 0.8);"></div>
     </div>
    </div><!-- Hit Markers Container -->
    <div id="hitMarkers" class="absolute inset-0 pointer-events-none"></div>
   </div><!-- Weapon Shop Screen -->
   <div id="weaponShopScreen" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-95 overflow-y-auto" style="z-index: 20;">
    <div class="flex items-center justify-center min-h-full py-12">
     <div class="bg-gradient-to-br from-yellow-900 to-black p-12 rounded-2xl border-2 border-yellow-500 text-center max-w-6xl" style="backdrop-filter: blur(20px);">
      <div class="text-yellow-400 text-6xl font-bold mb-4 tracking-wider">
       ğŸª ë¬´ê¸° ìƒì 
      </div>
      <div class="text-gray-300 text-2xl mb-2">
       ë³´ìœ  ì½”ì¸: <span class="text-yellow-400 font-bold text-4xl" id="shopCoinsDisplay">0</span> ğŸ’°
      </div>
      <div class="text-gray-400 text-lg mb-8">
       ì  20ë§ˆë¦¬ë§ˆë‹¤ 10ì½”ì¸ íšë“!
      </div>
      <div class="grid grid-cols-3 gap-6 mb-8"><!-- Burst Rifle - 300 -->
       <div class="weapon-shop-item relative bg-gradient-to-br from-blue-900 to-blue-700 p-6 rounded-xl border-2 border-blue-400">
        <div class="text-blue-400 text-3xl font-bold mb-2">
         ğŸ”« ì ì‚¬ì´
        </div>
        <div class="text-white text-base mb-2">
         3ë°œ ë¹ ë¥¸ ì ì‚¬!
        </div>
        <div class="text-gray-300 text-sm mb-1">
         íƒ„ì°½: 24ë°œ
        </div>
        <div class="text-gray-300 text-sm mb-3">
         ì—°ì‚¬ ì†ë„: ë¹ ë¦„
        </div>
        <div class="text-yellow-400 text-2xl font-bold mb-3">
         ğŸ’° 300
        </div><button class="buy-weapon-btn pointer-events-auto cursor-pointer bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 w-full" data-weapon="burst" data-cost="300"> êµ¬ë§¤í•˜ê¸° </button>
        <div class="locked-overlay hidden absolute inset-0 bg-black bg-opacity-70 rounded-xl flex items-center justify-center">
         <div class="text-green-400 text-2xl font-bold">
          âœ“ êµ¬ë§¤ ì™„ë£Œ!
         </div>
        </div>
       </div><!-- Plasma Gun - 400 -->
       <div class="weapon-shop-item relative bg-gradient-to-br from-teal-900 to-teal-700 p-6 rounded-xl border-2 border-teal-400">
        <div class="text-teal-400 text-3xl font-bold mb-2">
         âš¡ í”Œë¼ì¦ˆë§ˆì´
        </div>
        <div class="text-white text-base mb-2">
         ì—ë„ˆì§€ ì—°ì‚¬!
        </div>
        <div class="text-gray-300 text-sm mb-1">
         íƒ„ì°½: 35ë°œ
        </div>
        <div class="text-gray-300 text-sm mb-3">
         ì—°ì‚¬ ì†ë„: ë¹ ë¦„
        </div>
        <div class="text-yellow-400 text-2xl font-bold mb-3">
         ğŸ’° 400
        </div><button class="buy-weapon-btn pointer-events-auto cursor-pointer bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 w-full" data-weapon="plasma" data-cost="400"> êµ¬ë§¤í•˜ê¸° </button>
        <div class="locked-overlay hidden absolute inset-0 bg-black bg-opacity-70 rounded-xl flex items-center justify-center">
         <div class="text-green-400 text-2xl font-bold">
          âœ“ êµ¬ë§¤ ì™„ë£Œ!
         </div>
        </div>
       </div><!-- Double Shot - 500 -->
       <div class="weapon-shop-item relative bg-gradient-to-br from-pink-900 to-pink-700 p-6 rounded-xl border-2 border-pink-400">
        <div class="text-pink-400 text-3xl font-bold mb-2">
         ğŸ”« 2ì—°ë°œ ì´
        </div>
        <div class="text-white text-base mb-2">
         í•œ ë²ˆì— 2ë°œ ë°œì‚¬!
        </div>
        <div class="text-gray-300 text-sm mb-1">
         íƒ„ì°½: 20ë°œ
        </div>
        <div class="text-gray-300 text-sm mb-3">
         ì—°ì‚¬ ì†ë„: ë³´í†µ
        </div>
        <div class="text-yellow-400 text-2xl font-bold mb-3">
         ğŸ’° 500
        </div><button class="buy-weapon-btn pointer-events-auto cursor-pointer bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 w-full" data-weapon="doubleshot" data-cost="500"> êµ¬ë§¤í•˜ê¸° </button>
        <div class="locked-overlay hidden absolute inset-0 bg-black bg-opacity-70 rounded-xl flex items-center justify-center">
         <div class="text-green-400 text-2xl font-bold">
          âœ“ êµ¬ë§¤ ì™„ë£Œ!
         </div>
        </div>
       </div><!-- Sniper - 600 -->
       <div class="weapon-shop-item relative bg-gradient-to-br from-green-900 to-green-700 p-6 rounded-xl border-2 border-green-400">
        <div class="text-green-400 text-3xl font-bold mb-2">
         ğŸ¯ ì €ê²©ì´
        </div>
        <div class="text-white text-base mb-2">
         5ë°° ë°ë¯¸ì§€!
        </div>
        <div class="text-gray-300 text-sm mb-1">
         íƒ„ì°½: 5ë°œ
        </div>
        <div class="text-gray-300 text-sm mb-3">
         ì—°ì‚¬ ì†ë„: ë§¤ìš° ëŠë¦¼
        </div>
        <div class="text-yellow-400 text-2xl font-bold mb-3">
         ğŸ’° 600
        </div><button class="buy-weapon-btn pointer-events-auto cursor-pointer bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 w-full" data-weapon="sniper" data-cost="600"> êµ¬ë§¤í•˜ê¸° </button>
        <div class="locked-overlay hidden absolute inset-0 bg-black bg-opacity-70 rounded-xl flex items-center justify-center">
         <div class="text-green-400 text-2xl font-bold">
          âœ“ êµ¬ë§¤ ì™„ë£Œ!
         </div>
        </div>
       </div><!-- Triple Shot - 700 -->
       <div class="weapon-shop-item relative bg-gradient-to-br from-purple-900 to-purple-700 p-6 rounded-xl border-2 border-purple-400">
        <div class="text-purple-400 text-3xl font-bold mb-2">
         ğŸ”« 3ì—°ë°œ ì´
        </div>
        <div class="text-white text-base mb-2">
         í•œ ë²ˆì— 3ë°œ ë°œì‚¬!
        </div>
        <div class="text-gray-300 text-sm mb-1">
         íƒ„ì°½: 18ë°œ
        </div>
        <div class="text-gray-300 text-sm mb-3">
         ì—°ì‚¬ ì†ë„: ë³´í†µ
        </div>
        <div class="text-yellow-400 text-2xl font-bold mb-3">
         ğŸ’° 700
        </div><button class="buy-weapon-btn pointer-events-auto cursor-pointer bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 w-full" data-weapon="tripleshot" data-cost="700"> êµ¬ë§¤í•˜ê¸° </button>
        <div class="locked-overlay hidden absolute inset-0 bg-black bg-opacity-70 rounded-xl flex items-center justify-center">
         <div class="text-green-400 text-2xl font-bold">
          âœ“ êµ¬ë§¤ ì™„ë£Œ!
         </div>
        </div>
       </div><!-- Laser Gun - 800 -->
       <div class="weapon-shop-item relative bg-gradient-to-br from-emerald-900 to-emerald-700 p-6 rounded-xl border-2 border-emerald-400">
        <div class="text-emerald-400 text-3xl font-bold mb-2">
         ğŸ’š ë ˆì´ì €ê±´
        </div>
        <div class="text-white text-base mb-2">
         ê´€í†µ ë ˆì´ì €!
        </div>
        <div class="text-gray-300 text-sm mb-1">
         íƒ„ì°½: 30ë°œ
        </div>
        <div class="text-gray-300 text-sm mb-3">
         ì—°ì‚¬ ì†ë„: ë³´í†µ
        </div>
        <div class="text-yellow-400 text-2xl font-bold mb-3">
         ğŸ’° 800
        </div><button class="buy-weapon-btn pointer-events-auto cursor-pointer bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 w-full" data-weapon="laser" data-cost="800"> êµ¬ë§¤í•˜ê¸° </button>
        <div class="locked-overlay hidden absolute inset-0 bg-black bg-opacity-70 rounded-xl flex items-center justify-center">
         <div class="text-green-400 text-2xl font-bold">
          âœ“ êµ¬ë§¤ ì™„ë£Œ!
         </div>
        </div>
       </div><!-- Minigun - 900 -->
       <div class="weapon-shop-item relative bg-gradient-to-br from-orange-900 to-orange-700 p-6 rounded-xl border-2 border-orange-400">
        <div class="text-orange-400 text-3xl font-bold mb-2">
         ğŸ”¥ ë¯¸ë‹ˆê±´
        </div>
        <div class="text-white text-base mb-2">
         ì´ˆê³ ì† ì—°ì‚¬!
        </div>
        <div class="text-gray-300 text-sm mb-1">
         íƒ„ì°½: 100ë°œ
        </div>
        <div class="text-gray-300 text-sm mb-3">
         ì—°ì‚¬ ì†ë„: ë§¤ìš° ë¹ ë¦„
        </div>
        <div class="text-yellow-400 text-2xl font-bold mb-3">
         ğŸ’° 900
        </div><button class="buy-weapon-btn pointer-events-auto cursor-pointer bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 w-full" data-weapon="minigun" data-cost="900"> êµ¬ë§¤í•˜ê¸° </button>
        <div class="locked-overlay hidden absolute inset-0 bg-black bg-opacity-70 rounded-xl flex items-center justify-center">
         <div class="text-green-400 text-2xl font-bold">
          âœ“ êµ¬ë§¤ ì™„ë£Œ!
         </div>
        </div>
       </div><!-- Rocket Launcher - 1000 -->
       <div class="weapon-shop-item relative bg-gradient-to-br from-rose-900 to-rose-700 p-6 rounded-xl border-2 border-rose-400">
        <div class="text-rose-400 text-3xl font-bold mb-2">
         ğŸ’¥ ë¡œì¼“ ëŸ°ì²˜
        </div>
        <div class="text-white text-base mb-2">
         í­ë°œ ë²”ìœ„ ê³µê²©!
        </div>
        <div class="text-gray-300 text-sm mb-1">
         íƒ„ì°½: 4ë°œ
        </div>
        <div class="text-gray-300 text-sm mb-3">
         ì—°ì‚¬ ì†ë„: ëŠë¦¼
        </div>
        <div class="text-yellow-400 text-2xl font-bold mb-3">
         ğŸ’° 1000
        </div><button class="buy-weapon-btn pointer-events-auto cursor-pointer bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 w-full" data-weapon="rocket" data-cost="1000"> êµ¬ë§¤í•˜ê¸° </button>
        <div class="locked-overlay hidden absolute inset-0 bg-black bg-opacity-70 rounded-xl flex items-center justify-center">
         <div class="text-green-400 text-2xl font-bold">
          âœ“ êµ¬ë§¤ ì™„ë£Œ!
         </div>
        </div>
       </div><!-- Railgun - 1200 -->
       <div class="weapon-shop-item relative bg-gradient-to-br from-indigo-900 to-indigo-700 p-6 rounded-xl border-2 border-indigo-400">
        <div class="text-indigo-400 text-3xl font-bold mb-2">
         âš¡ ë ˆì¼ê±´
        </div>
        <div class="text-white text-base mb-2">
         ì¦‰ì‚¬ ê´€í†µíƒ„!
        </div>
        <div class="text-gray-300 text-sm mb-1">
         íƒ„ì°½: 3ë°œ
        </div>
        <div class="text-gray-300 text-sm mb-3">
         ì—°ì‚¬ ì†ë„: ë§¤ìš° ëŠë¦¼
        </div>
        <div class="text-yellow-400 text-2xl font-bold mb-3">
         ğŸ’° 1200
        </div><button class="buy-weapon-btn pointer-events-auto cursor-pointer bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 w-full" data-weapon="railgun" data-cost="1200"> êµ¬ë§¤í•˜ê¸° </button>
        <div class="locked-overlay hidden absolute inset-0 bg-black bg-opacity-70 rounded-xl flex items-center justify-center">
         <div class="text-green-400 text-2xl font-bold">
          âœ“ êµ¬ë§¤ ì™„ë£Œ!
         </div>
        </div>
       </div>
      </div><button id="closeShopBtn" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white px-10 py-4 rounded-lg text-2xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 border-2 border-gray-500"> â† ëŒì•„ê°€ê¸° </button>
     </div>
    </div>
   </div><!-- Upgrade Screen -->
   <div id="upgradeScreen" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-90 overflow-y-auto" style="z-index: 20;">
    <div class="flex items-center justify-center min-h-full py-12">
     <div class="bg-gradient-to-br from-purple-900 to-black p-12 rounded-2xl border-2 border-purple-500 text-center max-w-6xl" style="backdrop-filter: blur(20px);">
      <div class="text-purple-400 text-7xl font-bold mb-4 tracking-wider" style="text-shadow: 0 0 20px rgba(168, 85, 247, 0.5);">
       ë ˆë²¨ ì—…!
      </div>
      <div class="text-gray-300 text-3xl mb-8">
       ë¬´ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”
      </div>
      <div id="weaponSelection" class="grid grid-cols-3 gap-6 mb-8"><!-- Weapons will be dynamically inserted here -->
      </div>
     </div>
    </div>
   </div><!-- Pause Menu Screen -->
   <div id="pauseMenuScreen" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-90 overflow-y-auto" style="z-index: 20;">
    <div class="flex items-center justify-center min-h-full py-12">
     <div class="bg-gradient-to-br from-yellow-900 to-black p-12 rounded-2xl border-2 border-yellow-500 text-center max-w-2xl" style="backdrop-filter: blur(20px);">
      <div class="text-yellow-400 text-7xl font-bold mb-6 tracking-wider" style="text-shadow: 0 0 30px rgba(234, 179, 8, 0.8);">
       ì¼ì‹œì •ì§€
      </div>
      <div class="text-gray-300 text-2xl mb-8">
       ê²Œì„ì´ ì¼ì‹œì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤
      </div><!-- Current Stats -->
      <div class="bg-black bg-opacity-50 rounded-lg p-6 mb-8 border border-gray-700">
       <div class="text-cyan-400 text-2xl font-bold mb-4">
        í˜„ì¬ ìƒí™©
       </div>
       <div class="grid grid-cols-2 gap-4 text-gray-300 text-lg">
        <div>
         <div class="text-yellow-400">
          ì²˜ì¹˜
         </div>
         <div class="text-white text-3xl font-bold" id="pauseKills">
          0
         </div>
        </div>
        <div>
         <div class="text-green-400">
          ë ˆë²¨
         </div>
         <div class="text-white text-3xl font-bold" id="pauseLevel">
          1
         </div>
        </div>
        <div>
         <div class="text-cyan-400">
          ì²´ë ¥
         </div>
         <div class="text-white text-3xl font-bold" id="pauseHealth">
          100
         </div>
        </div>
        <div>
         <div class="text-purple-400">
          ì½”ì¸
         </div>
         <div class="text-white text-3xl font-bold" id="pauseCoins">
          0
         </div>
        </div>
       </div>
      </div>
      <div class="flex flex-col gap-4"><button id="resumeBtn" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white px-12 py-4 rounded-lg text-3xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 border-2 border-green-400" style="box-shadow: 0 0 30px rgba(34, 197, 94, 0.6);"> â–¶ ì´ì–´í•˜ê¸° </button> <button id="restartFromPauseBtn" class="bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 text-white px-12 py-4 rounded-lg text-3xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 border-2 border-cyan-400" style="box-shadow: 0 0 30px rgba(34, 211, 238, 0.6);"> ğŸ”„ ì¬ì‹œì‘ </button> <button id="homeFromPauseBtn" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-400 hover:to-purple-500 text-white px-12 py-4 rounded-lg text-3xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 border-2 border-purple-400" style="box-shadow: 0 0 30px rgba(168, 85, 247, 0.6);"> ğŸ  ë©”ì¸ í˜ì´ì§€ë¡œ </button>
      </div>
     </div>
    </div>
   </div><!-- Customization Screen -->
   <div id="customizeScreen" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-95 overflow-y-auto" style="z-index: 20;">
    <div class="flex items-center justify-center min-h-full py-12">
     <div class="bg-gradient-to-br from-purple-900 to-black p-12 rounded-2xl border-2 border-purple-500 text-center max-w-4xl" style="backdrop-filter: blur(20px);">
      <div class="text-purple-400 text-6xl font-bold mb-4 tracking-wider">
       ğŸ¨ ìºë¦­í„° ê¾¸ë¯¸ê¸°
      </div>
      <div class="text-gray-300 text-2xl mb-8">
       ë‚˜ë§Œì˜ ë¡œë´‡ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!
      </div><!-- Preview Canvas -->
      <div class="bg-gray-900 rounded-xl p-8 mb-8 border-2 border-cyan-400">
       <canvas id="previewCanvas" width="400" height="300" class="mx-auto rounded-lg"></canvas>
      </div><!-- Main Color Selection -->
      <div class="mb-8">
       <div class="text-cyan-400 text-3xl font-bold mb-4">
        ë©”ì¸ ì»¬ëŸ¬ (ëª¸ì²´/ë°”ì´ì €/ë¬´ê¸° í•˜ì´ë¼ì´íŠ¸)
       </div>
       <div class="flex gap-4 justify-center flex-wrap"><button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-white hover:scale-110 transition-transform" data-color="#22d3ee" data-type="main" style="background: #22d3ee;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#3b82f6" data-type="main" style="background: #3b82f6;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#a855f7" data-type="main" style="background: #a855f7;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#ef4444" data-type="main" style="background: #ef4444;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#f59e0b" data-type="main" style="background: #f59e0b;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#10b981" data-type="main" style="background: #10b981;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#ec4899" data-type="main" style="background: #ec4899;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#fbbf24" data-type="main" style="background: #fbbf24;"></button>
       </div>
      </div><!-- Secondary Color Selection -->
      <div class="mb-8">
       <div class="text-yellow-400 text-3xl font-bold mb-4">
        ë³´ì¡° ì»¬ëŸ¬ (í—¬ë©§/ì–´ê¹¨/ë¬´ê¸°)
       </div>
       <div class="flex gap-4 justify-center flex-wrap"><button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-white hover:scale-110 transition-transform" data-color="#1e293b" data-type="secondary" style="background: #1e293b;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#475569" data-type="secondary" style="background: #475569;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#7c2d12" data-type="secondary" style="background: #7c2d12;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#1e3a8a" data-type="secondary" style="background: #1e3a8a;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#581c87" data-type="secondary" style="background: #581c87;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#064e3b" data-type="secondary" style="background: #064e3b;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#78350f" data-type="secondary" style="background: #78350f;"></button> <button class="color-btn pointer-events-auto cursor-pointer w-20 h-20 rounded-lg border-4 border-gray-600 hover:border-white hover:scale-110 transition-all" data-color="#334155" data-type="secondary" style="background: #334155;"></button>
       </div>
      </div>
      <div class="flex gap-4 justify-center"><button id="saveCustomizationBtn" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white px-10 py-4 rounded-lg text-2xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 border-2 border-green-400"> âœ“ ì €ì¥í•˜ê¸° </button> <button id="backToMenuBtn" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white px-10 py-4 rounded-lg text-2xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 border-2 border-gray-500"> â† ë’¤ë¡œ ê°€ê¸° </button>
      </div>
     </div>
    </div>
   </div><!-- Difficulty Selection Screen -->
   <div id="difficultyScreen" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-95 overflow-y-auto" style="z-index: 20;">
    <div class="flex items-center justify-center min-h-full py-12">
     <div class="bg-gradient-to-br from-purple-900 to-black p-12 rounded-2xl border-2 border-purple-500 text-center max-w-4xl" style="backdrop-filter: blur(20px);">
      <div class="text-purple-400 text-7xl font-bold mb-6 tracking-wider" style="text-shadow: 0 0 30px rgba(168, 85, 247, 0.8);">
       ë‚œì´ë„ ì„ íƒ
      </div>
      <div class="text-gray-300 text-2xl mb-12">
       ìì‹ ì—ê²Œ ë§ëŠ” ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”
      </div>
      <div class="grid grid-cols-1 gap-6 mb-8"><!-- Easy Mode --> <button id="easyModeBtn" class="difficulty-btn pointer-events-auto cursor-pointer bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 p-8 rounded-xl border-2 border-green-400 transition-all duration-300 hover:scale-105" style="box-shadow: 0 0 30px rgba(34, 197, 94, 0.4);">
        <div class="text-green-400 text-5xl font-bold mb-3">
         ğŸ˜Š ì´ì§€ ëª¨ë“œ
        </div>
        <div class="text-white text-xl mb-3">
         ì´ˆë³´ìì—ê²Œ ì¶”ì²œ
        </div>
        <div class="grid grid-cols-2 gap-4 text-left text-gray-300 text-lg">
         <div>
          â€¢ ì  ì²´ë ¥: ë‚®ìŒ
         </div>
         <div>
          â€¢ ì  ì´ë™ ì†ë„: ëŠë¦¼
         </div>
         <div>
          â€¢ ì  ê³µê²©ë ¥: ì•½í•¨
         </div>
         <div>
          â€¢ ì  ìƒì„± ì†ë„: ëŠë¦¼
         </div>
        </div></button> <!-- Normal Mode --> <button id="normalModeBtn" class="difficulty-btn pointer-events-auto cursor-pointer bg-gradient-to-r from-cyan-600 to-blue-700 hover:from-cyan-500 hover:to-blue-600 p-8 rounded-xl border-2 border-cyan-400 transition-all duration-300 hover:scale-105" style="box-shadow: 0 0 30px rgba(34, 211, 238, 0.4);">
        <div class="text-cyan-400 text-5xl font-bold mb-3">
         ğŸ˜ ë³´í†µ ëª¨ë“œ
        </div>
        <div class="text-white text-xl mb-3">
         ê· í˜• ì¡íŒ ë‚œì´ë„
        </div>
        <div class="grid grid-cols-2 gap-4 text-left text-gray-300 text-lg">
         <div>
          â€¢ ì  ì²´ë ¥: ë³´í†µ
         </div>
         <div>
          â€¢ ì  ì´ë™ ì†ë„: ë³´í†µ
         </div>
         <div>
          â€¢ ì  ê³µê²©ë ¥: ë³´í†µ
         </div>
         <div>
          â€¢ ì  ìƒì„± ì†ë„: ë³´í†µ
         </div>
        </div></button> <!-- Hard Mode --> <button id="hardModeBtn" class="difficulty-btn pointer-events-auto cursor-pointer bg-gradient-to-r from-red-600 to-orange-700 hover:from-red-500 hover:to-orange-600 p-8 rounded-xl border-2 border-red-400 transition-all duration-300 hover:scale-105" style="box-shadow: 0 0 30px rgba(239, 68, 68, 0.4);">
        <div class="text-red-400 text-5xl font-bold mb-3">
         ğŸ˜ˆ í•˜ë“œ ëª¨ë“œ
        </div>
        <div class="text-white text-xl mb-3">
         ë„ì „ì ì¸ ê²Œì„ í”Œë ˆì´
        </div>
        <div class="grid grid-cols-2 gap-4 text-left text-gray-300 text-lg">
         <div>
          â€¢ ì  ì²´ë ¥: ë§¤ìš° ë†’ìŒ
         </div>
         <div>
          â€¢ ì  ì´ë™ ì†ë„: ë§¤ìš° ë¹ ë¦„
         </div>
         <div>
          â€¢ ì  ê³µê²©ë ¥: ë§¤ìš° ê°•í•¨
         </div>
         <div>
          â€¢ ì  ìƒì„± ì†ë„: ë§¤ìš° ë¹ ë¦„
         </div>
        </div></button>
      </div><button id="backFromDifficultyBtn" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white px-10 py-4 rounded-lg text-2xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 border-2 border-gray-500"> â† ë’¤ë¡œ ê°€ê¸° </button>
     </div>
    </div>
   </div><!-- Start Screen -->
   <div id="startScreen" class="absolute top-0 left-0 w-full h-full bg-black bg-opacity-95 overflow-y-auto" style="z-index: 20;">
    <div class="flex items-center justify-center min-h-full py-12">
     <div class="bg-gradient-to-br from-cyan-900 to-black p-12 rounded-2xl border-2 border-cyan-400 text-center max-w-3xl" style="backdrop-filter: blur(20px);">
      <div class="text-cyan-400 text-7xl font-bold mb-6 tracking-wider" style="text-shadow: 0 0 30px rgba(34, 211, 238, 0.8);">
       TACTICAL STRIKE
      </div>
      <div class="text-gray-300 text-2xl mb-8">
       ì „íˆ¬ FPS ìŠˆíŒ… ê²Œì„
      </div><!-- How to Play -->
      <div class="bg-black bg-opacity-50 rounded-lg p-6 mb-8 text-left">
       <div class="text-yellow-400 text-3xl font-bold mb-4 text-center">
        ğŸ® ê²Œì„ ë°©ë²•
       </div>
       <div class="grid grid-cols-2 gap-6 mb-6">
        <div>
         <div class="text-cyan-400 text-xl font-bold mb-2">
          ğŸ® ì¡°ì‘ë²•
         </div>
         <div class="text-gray-300 text-base space-y-1">
          <div>
           â€¢ <span class="text-white font-bold">WASD</span> - ì´ë™
          </div>
          <div>
           â€¢ <span class="text-white font-bold">ë§ˆìš°ìŠ¤</span> - ì¡°ì¤€
          </div>
          <div>
           â€¢ <span class="text-white font-bold">í´ë¦­</span> - ë°œì‚¬
          </div>
          <div>
           â€¢ <span class="text-white font-bold">R</span> - ì¬ì¥ì „
          </div>
         </div>
        </div>
        <div>
         <div class="text-red-400 text-xl font-bold mb-2">
          âš”ï¸ ë¬´ê¸° ì‹œìŠ¤í…œ
         </div>
         <div class="text-gray-300 text-base space-y-1">
          <div>
           â€¢ ì´ì•Œì„ ì „ë¶€ ì“°ë©´ <span class="text-purple-400">ë ˆë²¨ ì—…!</span>
          </div>
          <div>
           â€¢ êµ¬ë§¤í•œ ë¬´ê¸° ì¤‘ ì„ íƒ ê°€ëŠ¥
          </div>
          <div>
           â€¢ ë ˆë²¨ì´ ë†’ì„ìˆ˜ë¡ ì ì´ ê°•í•´ì§
          </div>
         </div>
        </div>
       </div>
       <div class="border-t border-gray-700 pt-4">
        <div class="text-green-400 text-xl font-bold mb-2">
         ğŸ’ ì•„ì´í…œ
        </div>
        <div class="grid grid-cols-2 gap-4 text-gray-300 text-base">
         <div>
          <div class="text-green-400">
           ğŸ¥ ì²´ë ¥ íŒ©
          </div>
          <div>
           ì  ì²˜ì¹˜ ì‹œ 15% í™•ë¥ ë¡œ ë“œë¡­
          </div>
          <div class="text-sm text-gray-400">
           HP +35 íšŒë³µ
          </div>
         </div>
         <div>
          <div class="text-blue-400">
           ğŸ’¨ ì†ë„ ë²„í”„
          </div>
          <div>
           ì´ë™ ì†ë„ 50% ì¦ê°€
          </div>
          <div class="text-sm text-gray-400">
           10ì´ˆê°„ ì§€ì†
          </div>
         </div>
         <div>
          <div class="text-red-400">
           ğŸ”¥ ê³µê²©ë ¥ ë²„í”„
          </div>
          <div>
           ê³µê²©ë ¥ 2ë°° ì¦ê°€
          </div>
          <div class="text-sm text-gray-400">
           10ì´ˆê°„ ì§€ì†
          </div>
         </div>
         <div>
          <div class="text-yellow-400">
           ğŸ›¡ï¸ ì‹¤ë“œ ë²„í”„
          </div>
          <div>
           ë°›ëŠ” í”¼í•´ 50% ê°ì†Œ
          </div>
          <div class="text-sm text-gray-400">
           10ì´ˆê°„ ì§€ì†
          </div>
         </div>
         <div>
          <div class="text-purple-400">
           ğŸ’¥ 3ì—°ë°œ ë²„í”„ (40%)
          </div>
          <div>
           í•œ ë²ˆì— 3ë°œ ë°œì‚¬
          </div>
          <div class="text-sm text-gray-400">
           10ì´ˆê°„ ì§€ì†
          </div>
         </div>
         <div>
          <div class="text-pink-400">
           ğŸ¯ 2ì—°ë°œ ë²„í”„ (40%)
          </div>
          <div>
           í•œ ë²ˆì— 2ë°œ ë°œì‚¬
          </div>
          <div class="text-sm text-gray-400">
           10ì´ˆê°„ ì§€ì†
          </div>
         </div>
        </div>
       </div>
      </div>
      <div class="mb-4 bg-black bg-opacity-50 rounded-lg p-3 inline-block">
       <div class="text-yellow-400 text-xl font-bold">
        ğŸ’° ë³´ìœ  ì½”ì¸: <span id="mainMenuCoins">0</span>
       </div>
      </div>
      <div class="flex gap-4 justify-center flex-wrap"><button id="startGameBtn" class="bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 text-white px-12 py-4 rounded-lg text-3xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 tracking-wider border-2 border-cyan-400" style="box-shadow: 0 0 30px rgba(34, 211, 238, 0.6);"> ê²Œì„ ì‹œì‘ </button> <button id="weaponShopBtn" class="bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-400 hover:to-orange-500 text-white px-12 py-4 rounded-lg text-3xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 tracking-wider border-2 border-yellow-400" style="box-shadow: 0 0 30px rgba(234, 179, 8, 0.6);"> ğŸª ë¬´ê¸° ìƒì  </button> <button id="customizeBtn" class="bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-400 hover:to-pink-500 text-white px-12 py-4 rounded-lg text-3xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 tracking-wider border-2 border-purple-400" style="box-shadow: 0 0 30px rgba(168, 85, 247, 0.6);"> ìºë¦­í„° ê¾¸ë¯¸ê¸° </button> <button id="viewRankingsBtn" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 text-white px-12 py-4 rounded-lg text-3xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 tracking-wider border-2 border-green-400" style="box-shadow: 0 0 30px rgba(34, 197, 94, 0.6);"> ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ </button>
      </div>
     </div>
    </div>
   </div><!-- Rankings Screen -->
   <div id="rankingsScreen" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-95 overflow-y-auto" style="z-index: 20;">
    <div class="flex items-center justify-center min-h-full py-12">
     <div class="bg-gradient-to-br from-green-900 to-black p-12 rounded-2xl border-2 border-green-500 text-center max-w-4xl" style="backdrop-filter: blur(20px);">
      <div class="text-green-400 text-7xl font-bold mb-6 tracking-wider" style="text-shadow: 0 0 30px rgba(34, 197, 94, 0.8);">
       ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹
      </div><!-- Difficulty Tabs -->
      <div class="flex gap-4 justify-center mb-8"><button id="easyTab" class="difficulty-tab pointer-events-auto cursor-pointer px-8 py-3 rounded-lg text-2xl font-bold transition-all duration-300 bg-green-600 border-2 border-green-400 text-white"> ğŸ˜Š ì´ì§€ </button> <button id="normalTab" class="difficulty-tab pointer-events-auto cursor-pointer px-8 py-3 rounded-lg text-2xl font-bold transition-all duration-300 bg-gray-700 border-2 border-gray-600 text-gray-300"> ğŸ˜ ë³´í†µ </button> <button id="hardTab" class="difficulty-tab pointer-events-auto cursor-pointer px-8 py-3 rounded-lg text-2xl font-bold transition-all duration-300 bg-gray-700 border-2 border-gray-600 text-gray-300"> ğŸ˜ˆ í•˜ë“œ </button>
      </div><!-- Rankings List -->
      <div class="bg-black bg-opacity-50 rounded-lg p-6 border border-gray-700 mb-8">
       <div id="mainRankingsList" class="text-left"><!-- Rankings will be inserted here -->
       </div>
      </div><button id="backFromRankingsBtn" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white px-10 py-4 rounded-lg text-2xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 border-2 border-gray-500"> â† ë’¤ë¡œ ê°€ê¸° </button>
     </div>
    </div>
   </div><!-- Mobile Controls -->
   <div id="mobileControls" class="hidden absolute bottom-0 left-0 w-full h-full pointer-events-none" style="z-index: 15;"><!-- Left Joystick (Movement) -->
    <div class="absolute bottom-8 left-8 pointer-events-auto">
     <div id="leftJoystickBase" class="relative w-32 h-32 bg-gray-800 bg-opacity-50 rounded-full border-2 border-cyan-400">
      <div id="leftJoystickKnob" class="absolute w-16 h-16 bg-cyan-400 bg-opacity-70 rounded-full" style="left: 50%; top: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 20px rgba(34, 211, 238, 0.6);"></div>
     </div>
     <div class="text-center text-cyan-400 text-sm mt-2 font-bold">
      ì´ë™
     </div>
    </div><!-- Right Joystick (Aim/Shoot) -->
    <div class="absolute bottom-8 right-8 pointer-events-auto">
     <div id="rightJoystickBase" class="relative w-32 h-32 bg-gray-800 bg-opacity-50 rounded-full border-2 border-red-400">
      <div id="rightJoystickKnob" class="absolute w-16 h-16 bg-red-400 bg-opacity-70 rounded-full" style="left: 50%; top: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);"></div>
     </div>
     <div class="text-center text-red-400 text-sm mt-2 font-bold">
      ì¡°ì¤€/ë°œì‚¬
     </div>
    </div><!-- Reload Button -->
    <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 pointer-events-auto"><button id="mobileReloadBtn" class="bg-purple-600 bg-opacity-70 text-white px-6 py-3 rounded-full text-xl font-bold border-2 border-purple-400 cursor-pointer" style="box-shadow: 0 0 20px rgba(168, 85, 247, 0.6);"> R </button>
    </div>
   </div><!-- Game Over Screen -->
   <div id="gameOver" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-90" style="z-index: 20; overflow-y: auto;">
    <div class="flex items-center justify-center min-h-full py-12">
     <div class="bg-gradient-to-br from-gray-900 to-black p-12 rounded-2xl border-2 border-red-500 text-center max-w-2xl" style="backdrop-filter: blur(20px);">
      <div class="text-red-500 text-7xl font-bold mb-4 tracking-wider" style="text-shadow: 0 0 20px rgba(239, 68, 68, 0.5);">
       ì‚¬ë§
      </div>
      <div class="text-gray-400 text-2xl mb-3 tracking-wide">
       ìµœì¢… ê¸°ë¡
      </div>
      <div class="mb-4">
       <div id="difficultyBadge" class="inline-block px-6 py-2 rounded-full text-xl font-bold mb-3"></div>
      </div>
      <div class="mb-6">
       <div class="text-yellow-400 text-2xl mb-1">
        ì²˜ì¹˜
       </div>
       <div class="text-white text-7xl font-bold" id="finalKills">
        0
       </div>
      </div><!-- Name Input -->
      <div class="mb-6">
       <div class="text-white text-2xl mb-3">
        ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”
       </div><input type="text" id="playerNameInput" maxlength="15" placeholder="í”Œë ˆì´ì–´ ì´ë¦„" class="pointer-events-auto bg-gray-800 border-2 border-gray-600 rounded-lg px-4 py-3 text-white text-center text-2xl w-80 focus:border-cyan-400 focus:outline-none">
      </div>
      <div id="duplicateNameWarning" class="hidden mb-4 bg-yellow-900 bg-opacity-50 border-2 border-yellow-400 rounded-lg p-4">
       <div class="text-yellow-400 text-2xl font-bold mb-3">
        âš ï¸ ê°™ì€ ì´ë¦„ì´ ìˆìŠµë‹ˆë‹¤
       </div>
       <div class="text-white text-lg mb-4">
        ê¸°ë¡ì„ ê°±ì‹ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
       </div>
       <div class="flex gap-3 justify-center"><button id="updateRecordBtn" class="bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-lg text-lg font-bold pointer-events-auto cursor-pointer transition-all duration-300"> ë„¤, ê°±ì‹ í•©ë‹ˆë‹¤ </button> <button id="keepBothBtn" class="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg text-lg font-bold pointer-events-auto cursor-pointer transition-all duration-300"> ì•„ë‹ˆì˜¤, ë‘˜ ë‹¤ ìœ ì§€ </button>
       </div>
      </div>
      <div class="flex gap-3 justify-center mb-4"><button id="saveScoreBtn" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 text-white px-8 py-4 rounded-lg text-xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 tracking-wider border-2 border-green-400" style="box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);"> ê¸°ë¡ ì €ì¥ </button> <button id="restartBtn" class="bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 text-white px-8 py-4 rounded-lg text-xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 tracking-wider border-2 border-cyan-400" style="box-shadow: 0 0 20px rgba(34, 211, 238, 0.4);"> ë‹¤ì‹œ ì‹œì‘ </button>
      </div><button id="backToHomeBtn" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-400 hover:to-purple-500 text-white px-8 py-4 rounded-lg text-xl font-bold pointer-events-auto cursor-pointer transition-all duration-300 tracking-wider border-2 border-purple-400 mb-6" style="box-shadow: 0 0 20px rgba(168, 85, 247, 0.4);"> ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° </button> <!-- Rankings Display -->
      <div class="mt-8 bg-black bg-opacity-50 rounded-lg p-6 border border-gray-700">
       <div class="text-yellow-400 text-3xl font-bold mb-4">
        ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹
       </div>
       <div id="rankingsList" class="text-left"><!-- Rankings will be inserted here -->
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    const defaultConfig = {
      game_title: "TACTICAL STRIKE",
      controls_guide: "WASD: ì´ë™ | ë§ˆìš°ìŠ¤: ì¡°ì¤€ | í´ë¦­: ë°œì‚¬ | R: ì¬ì¥ì „",
      background_color: "#0f172a",
      player_color: "#22d3ee",
      enemy_color: "#ef4444",
      bullet_color: "#fbbf24",
      ui_accent: "#a855f7"
    };

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let gameRunning = false;
    let kills = 0;
    let currentLevel = 1;
    let coins = 0;
    let currentGameCoins = 0;
    let unlockedWeapons = ['assault', 'shotgun', 'smg'];
    let allRankings = [];
    let player = null;
    let enemies = [];
    let bullets = [];
    let particles = [];
    let healthPacks = [];
    let powerUps = [];
    let explosions = [];
    let mouseX = 0;
    let mouseY = 0;
    let keys = {};
    let spawnEnemyTimeout = null;
    let mouseDown = false;
    let currentDifficulty = 'normal';
    let playerCustomization = { mainColor: '#22d3ee', secondaryColor: '#1e293b' };
    let currentPlayerName = '';
    let dataInitialized = false;
    let gamePaused = false;
    
    let isMobile = false;
    let leftJoystick = { active: false, x: 0, y: 0, identifier: null };
    let rightJoystick = { active: false, x: 0, y: 0, identifier: null, shooting: false };
    
    function detectMobile() {
      isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
      if (isMobile && gameRunning) {
        document.getElementById('mobileControls').classList.remove('hidden');
      } else {
        document.getElementById('mobileControls').classList.add('hidden');
      }
    }
    
    detectMobile();
    window.addEventListener('resize', detectMobile);
    
    const dataHandler = {
      onDataChanged(data) {
        allRankings = data || [];
        
        const easyRankings = allRankings.filter(r => r.difficulty === 'easy');
        const normalRankings = allRankings.filter(r => r.difficulty === 'normal');
        const hardRankings = allRankings.filter(r => r.difficulty === 'hard');
        
        const gameOverVisible = !document.getElementById('gameOver').classList.contains('hidden');
        const rankingsVisible = !document.getElementById('rankingsScreen').classList.contains('hidden');
        
        if (gameOverVisible) {
          displayRankings();
        }
        
        if (rankingsVisible) {
          displayMainRankings(viewingDifficulty);
        }
      }
    };
    
    (async function initDataSdk() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (result.isOk) {
          dataInitialized = true;
        } else {
          console.error('Data SDK ì´ˆê¸°í™” ì‹¤íŒ¨');
        }
      }
    })();
    
    const difficultySettings = {
      easy: {
        enemyHealthMultiplier: 0.6,
        enemySpeedMultiplier: 0.7,
        enemyDamageMultiplier: 0.6,
        spawnDelayMultiplier: 1.5,
        shootDelayMultiplier: 1.5
      },
      normal: {
        enemyHealthMultiplier: 1,
        enemySpeedMultiplier: 1,
        enemyDamageMultiplier: 1,
        spawnDelayMultiplier: 1,
        shootDelayMultiplier: 1
      },
      hard: {
        enemyHealthMultiplier: 2.2,
        enemySpeedMultiplier: 1.6,
        enemyDamageMultiplier: 1.8,
        spawnDelayMultiplier: 0.6,
        shootDelayMultiplier: 0.6
      }
    };
    
    function resizeCanvas() {
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
    }
    
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    class Explosion {
      constructor(x, y, radius) {
        this.x = x;
        this.y = y;
        this.radius = radius;
        this.maxRadius = radius;
        this.life = 30;
        this.maxLife = 30;
      }
      
      update() {
        this.life--;
        return this.life <= 0;
      }
      
      draw() {
        const alpha = this.life / this.maxLife;
        const currentRadius = this.maxRadius * (1 - alpha * 0.3);
        
        ctx.globalAlpha = alpha * 0.6;
        ctx.fillStyle = '#ff4400';
        ctx.beginPath();
        ctx.arc(this.x, this.y, currentRadius, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.globalAlpha = alpha * 0.4;
        ctx.fillStyle = '#ffaa00';
        ctx.beginPath();
        ctx.arc(this.x, this.y, currentRadius * 0.7, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.globalAlpha = 1;
      }
    }
    
    class Particle {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 4;
        this.vy = (Math.random() - 0.5) * 4;
        this.life = 30;
        this.maxLife = 30;
        this.size = Math.random() * 3 + 2;
        this.color = color;
      }
      
      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.1;
        this.life--;
        return this.life <= 0;
      }
      
      draw() {
        const alpha = this.life / this.maxLife;
        ctx.fillStyle = this.color.replace(')', `, ${alpha})`).replace('rgb', 'rgba');
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }
    
    class HealthPack {
      constructor() {
        this.x = Math.random() * (canvas.width - 60) + 30;
        this.y = Math.random() * (canvas.height - 60) + 30;
        this.size = 20;
        this.bobOffset = Math.random() * Math.PI * 2;
        this.lifetime = 600;
      }
      
      update() {
        this.lifetime--;
        return this.lifetime <= 0;
      }
      
      draw() {
        const bob = Math.sin(Date.now() * 0.005 + this.bobOffset) * 5;
        
        ctx.shadowBlur = 20 + Math.sin(Date.now() * 0.01) * 10;
        ctx.shadowColor = '#22c55e';
        
        ctx.fillStyle = '#22c55e';
        ctx.fillRect(this.x - this.size/2, this.y - this.size/2 + bob, this.size, this.size);
        
        ctx.shadowBlur = 0;
        ctx.fillStyle = 'white';
        ctx.fillRect(this.x - this.size/2 + 6, this.y - 2 + bob, this.size - 12, 4);
        ctx.fillRect(this.x - 2, this.y - this.size/2 + 6 + bob, 4, this.size - 12);
        
        if (this.lifetime < 180) {
          ctx.globalAlpha = 0.3 + Math.sin(Date.now() * 0.02) * 0.3;
          ctx.fillStyle = '#ef4444';
          const barWidth = this.size;
          const barHeight = 3;
          ctx.fillRect(this.x - barWidth/2, this.y + this.size/2 + 8 + bob, barWidth * (this.lifetime / 180), barHeight);
          ctx.globalAlpha = 1;
        }
      }
      
      checkCollision(player) {
        const dx = this.x - player.x;
        const dy = this.y - player.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        return dist < this.size + player.size;
      }
    }
    
    class PowerUp {
      constructor(type) {
        this.x = Math.random() * (canvas.width - 60) + 30;
        this.y = Math.random() * (canvas.height - 60) + 30;
        this.size = 18;
        this.type = type;
        this.bobOffset = Math.random() * Math.PI * 2;
        this.lifetime = 450;
        this.rotation = 0;
      }
      
      update() {
        this.lifetime--;
        this.rotation += 0.05;
        return this.lifetime <= 0;
      }
      
      draw() {
        const bob = Math.sin(Date.now() * 0.005 + this.bobOffset) * 5;
        
        ctx.save();
        ctx.translate(this.x, this.y + bob);
        ctx.rotate(this.rotation);
        
        let color = '#a855f7';
        if (this.type === 'speed') color = '#3b82f6';
        else if (this.type === 'damage') color = '#ef4444';
        else if (this.type === 'shield') color = '#fbbf24';
        else if (this.type === 'multiburst') color = '#a855f7';
        else if (this.type === 'doubleburst') color = '#ec4899';
        
        ctx.shadowBlur = 20 + Math.sin(Date.now() * 0.01) * 10;
        ctx.shadowColor = color;
        
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.moveTo(0, -this.size);
        ctx.lineTo(this.size, 0);
        ctx.lineTo(0, this.size);
        ctx.lineTo(-this.size, 0);
        ctx.closePath();
        ctx.fill();
        
        ctx.shadowBlur = 0;
        ctx.fillStyle = 'white';
        ctx.globalAlpha = 0.5;
        ctx.beginPath();
        ctx.moveTo(0, -this.size * 0.5);
        ctx.lineTo(this.size * 0.5, 0);
        ctx.lineTo(0, this.size * 0.5);
        ctx.lineTo(-this.size * 0.5, 0);
        ctx.closePath();
        ctx.fill();
        ctx.globalAlpha = 1;
        
        ctx.restore();
      }
      
      checkCollision(player) {
        const dx = this.x - player.x;
        const dy = this.y - player.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        return dist < this.size + player.size;
      }
    }
    
    class Player {
      constructor() {
        this.x = canvas.width / 2;
        this.y = canvas.height / 2;
        this.size = 22;
        this.speed = 5;
        this.baseSpeed = 5;
        this.health = 100;
        this.maxHealth = 100;
        this.weapon = 'assault';
        this.setWeapon(this.weapon);
        this.reloading = false;
        this.reloadTime = 0;
        this.shootCooldown = 0;
        this.burstCount = 0;
        this.burstDelay = 0;
        this.powerUps = {
          speed: 0,
          damage: 0,
          shield: 0,
          multiburst: 0,
          doubleburst: 0
        };
      }
      
      setWeapon(weaponType) {
        this.weapon = weaponType;
        const levelBonus = (currentLevel - 1) * 30;
        
        if (weaponType === 'assault') {
          this.maxAmmo = 30;
          this.ammo = 30;
          this.reserveAmmo = 90 + levelBonus;
          this.shootCooldownMax = 8;
          this.reloadTimeMax = 90;
          this.bulletCount = 1;
          this.bulletSpread = 0;
          this.bulletType = 'normal';
        } else if (weaponType === 'shotgun') {
          this.maxAmmo = 8;
          this.ammo = 8;
          this.reserveAmmo = 32 + levelBonus;
          this.shootCooldownMax = 25;
          this.reloadTimeMax = 120;
          this.bulletCount = 5;
          this.bulletSpread = 0.3;
          this.bulletType = 'normal';
        } else if (weaponType === 'smg') {
          this.maxAmmo = 40;
          this.ammo = 40;
          this.reserveAmmo = 120 + levelBonus;
          this.shootCooldownMax = 4;
          this.reloadTimeMax = 75;
          this.bulletCount = 1;
          this.bulletSpread = 0.1;
          this.bulletType = 'normal';
        } else if (weaponType === 'doubleshot') {
          this.maxAmmo = 20;
          this.ammo = 20;
          this.reserveAmmo = 80 + levelBonus;
          this.shootCooldownMax = 10;
          this.reloadTimeMax = 85;
          this.bulletCount = 2;
          this.bulletSpread = 0.05;
          this.bulletType = 'normal';
        } else if (weaponType === 'tripleshot') {
          this.maxAmmo = 18;
          this.ammo = 18;
          this.reserveAmmo = 72 + levelBonus;
          this.shootCooldownMax = 12;
          this.reloadTimeMax = 95;
          this.bulletCount = 3;
          this.bulletSpread = 0.08;
          this.bulletType = 'normal';
        } else if (weaponType === 'sniper') {
          this.maxAmmo = 5;
          this.ammo = 5;
          this.reserveAmmo = 20 + Math.floor(levelBonus / 3);
          this.shootCooldownMax = 40;
          this.reloadTimeMax = 110;
          this.bulletCount = 1;
          this.bulletSpread = 0;
          this.bulletType = 'sniper';
          this.bulletDamage = 5;
        } else if (weaponType === 'burst') {
          this.maxAmmo = 24;
          this.ammo = 24;
          this.reserveAmmo = 72 + levelBonus;
          this.shootCooldownMax = 20;
          this.reloadTimeMax = 80;
          this.bulletCount = 1;
          this.bulletSpread = 0.02;
          this.bulletType = 'burst';
          this.burstSize = 3;
          this.burstDelayMax = 3;
        } else if (weaponType === 'minigun') {
          this.maxAmmo = 100;
          this.ammo = 100;
          this.reserveAmmo = 200 + levelBonus * 2;
          this.shootCooldownMax = 2;
          this.reloadTimeMax = 150;
          this.bulletCount = 1;
          this.bulletSpread = 0.15;
          this.bulletType = 'normal';
        } else if (weaponType === 'laser') {
          this.maxAmmo = 30;
          this.ammo = 30;
          this.reserveAmmo = 90 + levelBonus;
          this.shootCooldownMax = 10;
          this.reloadTimeMax = 85;
          this.bulletCount = 1;
          this.bulletSpread = 0;
          this.bulletType = 'laser';
        } else if (weaponType === 'rocket') {
          this.maxAmmo = 4;
          this.ammo = 4;
          this.reserveAmmo = 12 + Math.floor(levelBonus / 4);
          this.shootCooldownMax = 50;
          this.reloadTimeMax = 130;
          this.bulletCount = 1;
          this.bulletSpread = 0;
          this.bulletType = 'rocket';
        } else if (weaponType === 'railgun') {
          this.maxAmmo = 3;
          this.ammo = 3;
          this.reserveAmmo = 9 + Math.floor(levelBonus / 5);
          this.shootCooldownMax = 60;
          this.reloadTimeMax = 140;
          this.bulletCount = 1;
          this.bulletSpread = 0;
          this.bulletType = 'railgun';
        } else if (weaponType === 'plasma') {
          this.maxAmmo = 35;
          this.ammo = 35;
          this.reserveAmmo = 105 + levelBonus;
          this.shootCooldownMax = 5;
          this.reloadTimeMax = 80;
          this.bulletCount = 1;
          this.bulletSpread = 0.05;
          this.bulletType = 'plasma';
        }
      }
      
      update() {
        if (this.powerUps.speed > 0) {
          this.powerUps.speed--;
          this.speed = this.baseSpeed * 1.5;
        } else {
          this.speed = this.baseSpeed;
        }
        
        if (this.powerUps.damage > 0) {
          this.powerUps.damage--;
        }
        
        if (this.powerUps.shield > 0) {
          this.powerUps.shield--;
        }
        
        if (this.powerUps.multiburst > 0) {
          this.powerUps.multiburst--;
        }
        
        if (this.powerUps.doubleburst > 0) {
          this.powerUps.doubleburst--;
        }
        
        let moveX = 0;
        let moveY = 0;
        
        if (isMobile && leftJoystick.active) {
          moveX = leftJoystick.x;
          moveY = leftJoystick.y;
        } else {
          if (keys['w'] || keys['W']) moveY -= 1;
          if (keys['s'] || keys['S']) moveY += 1;
          if (keys['a'] || keys['A']) moveX -= 1;
          if (keys['d'] || keys['D']) moveX += 1;
        }
        
        if (isMobile && rightJoystick.active) {
          const aimAngle = Math.atan2(rightJoystick.y, rightJoystick.x);
          mouseX = this.x + Math.cos(aimAngle) * 200;
          mouseY = this.y + Math.sin(aimAngle) * 200;
          
          if (rightJoystick.shooting) {
            this.shoot();
          }
        }
        
        if (moveX !== 0 && moveY !== 0) {
          moveX *= 0.707;
          moveY *= 0.707;
        }
        
        this.x += moveX * this.speed;
        this.y += moveY * this.speed;
        
        this.x = Math.max(this.size, Math.min(canvas.width - this.size, this.x));
        this.y = Math.max(this.size, Math.min(canvas.height - this.size, this.y));
        
        if (this.reloadTime > 0) {
          this.reloadTime--;
          if (this.reloadTime === 0) {
            const neededAmmo = this.maxAmmo - this.ammo;
            const ammoToReload = Math.min(neededAmmo, this.reserveAmmo);
            this.ammo += ammoToReload;
            this.reserveAmmo -= ammoToReload;
            this.reloading = false;
            document.getElementById('reloadText').classList.add('hidden');
            updateHUD();
          }
        }
        
        if (this.shootCooldown > 0) {
          this.shootCooldown--;
        }
        
        if (this.burstDelay > 0) {
          this.burstDelay--;
          if (this.burstDelay === 0 && this.burstCount > 0) {
            this.shootBurst();
          }
        }
        
        if (mouseDown && gameRunning) {
          this.shoot();
        }
        
        if (this.ammo === 0 && this.reserveAmmo === 0 && !this.reloading && gameRunning) {
          showUpgradeScreen();
        }
      }
      
      heal(amount) {
        this.health = Math.min(this.maxHealth, this.health + amount);
        updateHUD();
        
        for (let i = 0; i < 20; i++) {
          particles.push(new Particle(this.x, this.y, 'rgb(34, 197, 94)'));
        }
      }
      
      applyPowerUp(type) {
        const duration = 600;
        if (type === 'speed') {
          this.powerUps.speed = duration;
        } else if (type === 'damage') {
          this.powerUps.damage = duration;
        } else if (type === 'shield') {
          this.powerUps.shield = duration;
        } else if (type === 'multiburst') {
          this.powerUps.multiburst = duration;
        } else if (type === 'doubleburst') {
          this.powerUps.doubleburst = duration;
        }
        
        let color = 'rgb(168, 85, 247)';
        if (type === 'speed') color = 'rgb(59, 130, 246)';
        else if (type === 'damage') color = 'rgb(239, 68, 68)';
        else if (type === 'shield') color = 'rgb(251, 191, 36)';
        else if (type === 'multiburst') color = 'rgb(168, 85, 247)';
        else if (type === 'doubleburst') color = 'rgb(236, 72, 153)';
        
        for (let i = 0; i < 30; i++) {
          particles.push(new Particle(this.x, this.y, color));
        }
      }
      
      draw() {
        const angle = Math.atan2(mouseY - this.y, mouseX - this.x);
        
        if (this.powerUps.shield > 0) {
          ctx.strokeStyle = '#fbbf24';
          ctx.lineWidth = 3;
          ctx.shadowBlur = 15;
          ctx.shadowColor = '#fbbf24';
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size * 1.8, 0, Math.PI * 2);
          ctx.stroke();
          ctx.shadowBlur = 0;
        }
        
        const moveSpeed = Math.sqrt(
          (keys['w'] || keys['W'] || keys['s'] || keys['S'] ? 1 : 0) +
          (keys['a'] || keys['A'] || keys['d'] || keys['D'] ? 1 : 0)
        );
        const bobAmount = moveSpeed > 0 ? Math.sin(Date.now() * 0.01) * 3 : 0;
        const weaponBob = moveSpeed > 0 ? Math.sin(Date.now() * 0.01) * 2 : 0;
        
        ctx.save();
        ctx.translate(this.x, this.y + bobAmount);
        ctx.rotate(angle);
        
        let mainColor = playerCustomization.mainColor;
        if (this.powerUps.speed > 0) mainColor = '#3b82f6';
        if (this.powerUps.damage > 0) mainColor = '#ef4444';
        
        ctx.fillStyle = mainColor;
        ctx.shadowBlur = 15;
        ctx.shadowColor = mainColor;
        ctx.beginPath();
        ctx.moveTo(this.size * 1.2, 0);
        ctx.lineTo(this.size * 0.5, this.size * 0.6);
        ctx.lineTo(-this.size * 0.8, this.size * 0.6);
        ctx.lineTo(-this.size * 1.2, 0);
        ctx.lineTo(-this.size * 0.8, -this.size * 0.6);
        ctx.lineTo(this.size * 0.5, -this.size * 0.6);
        ctx.closePath();
        ctx.fill();
        
        ctx.shadowBlur = 0;
        ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        ctx.fillStyle = playerCustomization.secondaryColor;
        ctx.beginPath();
        ctx.arc(-this.size * 0.5, 0, this.size * 0.4, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = mainColor;
        ctx.globalAlpha = 0.8;
        ctx.beginPath();
        ctx.arc(-this.size * 0.5, 0, this.size * 0.25, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
        
        ctx.fillStyle = playerCustomization.secondaryColor;
        ctx.beginPath();
        ctx.ellipse(this.size * 0.2, -this.size * 0.5, this.size * 0.3, this.size * 0.2, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.ellipse(this.size * 0.2, this.size * 0.5, this.size * 0.3, this.size * 0.2, 0, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = playerCustomization.secondaryColor;
        ctx.fillRect(this.size * 0.8, -5 + weaponBob, 24, 10);
        
        ctx.fillStyle = playerCustomization.secondaryColor;
        ctx.fillRect(this.size * 0.5, -3 + weaponBob, 10, 6);
        
        ctx.fillStyle = '#0f172a';
        ctx.fillRect(this.size * 0.8 + 24, -3 + weaponBob, 6, 6);
        
        ctx.fillStyle = '#94a3b8';
        ctx.fillRect(this.size * 0.8 + 8, -8 + weaponBob, 8, 3);
        
        ctx.fillStyle = mainColor;
        ctx.fillRect(this.size * 0.8 + 2, -4 + weaponBob, 18, 2);
        
        ctx.restore();
      }
      
      shootBurst() {
        if (this.ammo > 0 && this.burstCount > 0) {
          const angle = Math.atan2(mouseY - this.y, mouseX - this.x);
          const gunLength = 35;
          const gunX = this.x + Math.cos(angle) * gunLength;
          const gunY = this.y + Math.sin(angle) * gunLength;
          
          const spread = (Math.random() - 0.5) * this.bulletSpread;
          bullets.push(new Bullet(gunX, gunY, angle + spread, true, this.bulletType, this.bulletDamage || 1));
          
          this.ammo--;
          this.burstCount--;
          
          for (let i = 0; i < 3; i++) {
            particles.push(new Particle(gunX, gunY, 'rgb(251, 191, 36)'));
          }
          
          if (this.burstCount > 0) {
            this.burstDelay = this.burstDelayMax;
          }
          
          updateHUD();
        }
      }
      
      shoot() {
        if (this.ammo > 0 && this.shootCooldown === 0 && !this.reloading && this.burstCount === 0) {
          const angle = Math.atan2(mouseY - this.y, mouseX - this.x);
          const gunLength = 35;
          const gunX = this.x + Math.cos(angle) * gunLength;
          const gunY = this.y + Math.sin(angle) * gunLength;
          
          if (this.bulletType === 'burst') {
            this.burstCount = this.burstSize;
            this.shootBurst();
            this.shootCooldown = this.shootCooldownMax;
            return;
          }
          
          let shotsToFire = 1;
          if (this.powerUps.multiburst > 0) {
            shotsToFire = 3;
          } else if (this.powerUps.doubleburst > 0) {
            shotsToFire = 2;
          }
          
          for (let shot = 0; shot < shotsToFire; shot++) {
            for (let i = 0; i < this.bulletCount; i++) {
              const spread = (Math.random() - 0.5) * this.bulletSpread;
              let burstSpread = 0;
              if (shotsToFire === 3) {
                burstSpread = (shot - 1) * 0.15;
              } else if (shotsToFire === 2) {
                burstSpread = (shot - 0.5) * 0.1;
              }
              bullets.push(new Bullet(gunX, gunY, angle + spread + burstSpread, true, this.bulletType, this.bulletDamage || 1));
            }
          }
          
          this.ammo--;
          this.shootCooldown = this.shootCooldownMax;
          
          const particleCount = this.weapon === 'shotgun' ? 10 : 5;
          for (let i = 0; i < particleCount * shotsToFire; i++) {
            particles.push(new Particle(gunX, gunY, 'rgb(251, 191, 36)'));
          }
          
          updateHUD();
        }
      }
      
      reload() {
        if (!this.reloading && this.ammo < this.maxAmmo && this.reserveAmmo > 0) {
          this.reloading = true;
          this.reloadTime = this.reloadTimeMax;
          document.getElementById('reloadText').classList.remove('hidden');
        }
      }
      
      takeDamage(amount) {
        if (this.powerUps.shield > 0) {
          amount *= 0.5;
        }
        
        this.health -= amount;
        const damageFlash = document.getElementById('damageFlash');
        damageFlash.style.opacity = '0.3';
        damageFlash.classList.remove('damage-flash');
        void damageFlash.offsetWidth;
        damageFlash.classList.add('damage-flash');
        setTimeout(() => damageFlash.style.opacity = '0', 200);
        
        if (this.health <= 0) {
          endGame();
        }
        updateHUD();
      }
    }
    
    class Enemy {
      constructor() {
        const side = Math.floor(Math.random() * 4);
        const margin = 50;
        
        if (side === 0) {
          this.x = Math.random() * canvas.width;
          this.y = -margin;
        } else if (side === 1) {
          this.x = canvas.width + margin;
          this.y = Math.random() * canvas.height;
        } else if (side === 2) {
          this.x = Math.random() * canvas.width;
          this.y = canvas.height + margin;
        } else {
          this.x = -margin;
          this.y = Math.random() * canvas.height;
        }
        
        const difficulty = difficultySettings[currentDifficulty];
        
        this.size = 20;
        this.speed = (1.5 + Math.random() * 0.8 + (currentLevel * 0.08)) * difficulty.enemySpeedMultiplier;
        this.health = Math.ceil((2 + Math.floor(currentLevel / 5)) * difficulty.enemyHealthMultiplier);
        this.maxHealth = this.health;
        this.shootCooldown = 0;
        this.shootDelay = (Math.max(60, 100 - currentLevel * 3) + Math.random() * 60) * difficulty.shootDelayMultiplier;
        this.damage = 5 * difficulty.enemyDamageMultiplier;
      }
      
      update() {
        if (!player) return;
        
        const dx = player.x - this.x;
        const dy = player.y - this.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        
        if (dist > 150) {
          this.x += (dx / dist) * this.speed;
          this.y += (dy / dist) * this.speed;
        }
        
        this.shootCooldown--;
        if (this.shootCooldown <= 0 && dist < 400) {
          const angle = Math.atan2(dy, dx);
          const spread = (Math.random() - 0.5) * 0.3;
          bullets.push(new Bullet(this.x, this.y, angle + spread, false, 'normal', 1));
          this.shootCooldown = this.shootDelay;
        }
      }
      
      draw() {
        const config = window.elementSdk?.config || defaultConfig;
        const angle = player ? Math.atan2(player.y - this.y, player.x - this.x) : 0;
        
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(angle);
        
        ctx.fillStyle = config.enemy_color || defaultConfig.enemy_color;
        ctx.shadowBlur = 15;
        ctx.shadowColor = config.enemy_color || defaultConfig.enemy_color;
        ctx.fillRect(-this.size, -this.size/2, this.size * 2.2, this.size);
        
        ctx.shadowBlur = 0;
        ctx.fillStyle = '#7c2d12';
        ctx.fillRect(this.size * 0.8, -3, 16, 6);
        
        ctx.restore();
        
        if (this.health < this.maxHealth) {
          const barWidth = 40;
          const barHeight = 4;
          const barX = this.x - barWidth / 2;
          const barY = this.y - this.size - 15;
          
          ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
          ctx.fillRect(barX, barY, barWidth, barHeight);
          
          const healthPercent = this.health / this.maxHealth;
          ctx.fillStyle = config.enemy_color || defaultConfig.enemy_color;
          ctx.fillRect(barX, barY, barWidth * healthPercent, barHeight);
        }
      }
      
      takeDamage(amount) {
        this.health -= amount;
        for (let i = 0; i < 8; i++) {
          particles.push(new Particle(this.x, this.y, 'rgb(239, 68, 68)'));
        }
        
        if (this.health <= 0) {
          const dropChance = Math.random();
          if (dropChance < 0.15) {
            healthPacks.push(new HealthPack());
          } else if (dropChance < 0.55) {
            const powerUpTypes = ['speed', 'damage', 'shield', 'multiburst', 'doubleburst'];
            const randomType = powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];
            powerUps.push(new PowerUp(randomType));
          }
        }
        
        return this.health <= 0;
      }
    }
    
    class Bullet {
      constructor(x, y, angle, isPlayer, type = 'normal', damage = 1) {
        this.x = x;
        this.y = y;
        this.angle = angle;
        this.speed = isPlayer ? (type === 'rocket' ? 8 : 12) : 8;
        this.size = type === 'rocket' ? 6 : (type === 'sniper' ? 6 : 4);
        this.isPlayer = isPlayer;
        this.type = type;
        this.damage = damage;
        this.trail = [];
        this.pierced = [];
      }
      
      update() {
        this.trail.push({ x: this.x, y: this.y });
        if (this.trail.length > (this.type === 'laser' || this.type === 'railgun' ? 15 : 5)) this.trail.shift();
        
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed;
        
        return this.x < -50 || this.x > canvas.width + 50 || 
               this.y < -50 || this.y > canvas.height + 50;
      }
      
      draw() {
        const config = window.elementSdk?.config || defaultConfig;
        
        if (this.type === 'laser') {
          ctx.strokeStyle = this.isPlayer ? '#10b981' : (config.enemy_color || defaultConfig.enemy_color);
          ctx.lineWidth = 3;
          ctx.shadowBlur = 15;
          ctx.shadowColor = ctx.strokeStyle;
          
          if (this.trail.length > 1) {
            ctx.beginPath();
            ctx.moveTo(this.trail[0].x, this.trail[0].y);
            for (let i = 1; i < this.trail.length; i++) {
              ctx.lineTo(this.trail[i].x, this.trail[i].y);
            }
            ctx.stroke();
          }
          ctx.shadowBlur = 0;
          
          ctx.fillStyle = '#22d3ae';
          ctx.shadowBlur = 20;
          ctx.shadowColor = '#10b981';
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size + 2, 0, Math.PI * 2);
          ctx.fill();
          ctx.shadowBlur = 0;
          return;
        }
        
        if (this.type === 'railgun') {
          ctx.strokeStyle = '#6366f1';
          ctx.lineWidth = 4;
          ctx.shadowBlur = 20;
          ctx.shadowColor = '#6366f1';
          
          if (this.trail.length > 1) {
            ctx.beginPath();
            ctx.moveTo(this.trail[0].x, this.trail[0].y);
            for (let i = 1; i < this.trail.length; i++) {
              ctx.lineTo(this.trail[i].x, this.trail[i].y);
            }
            ctx.stroke();
          }
          ctx.shadowBlur = 0;
          
          ctx.fillStyle = '#a5b4fc';
          ctx.shadowBlur = 25;
          ctx.shadowColor = '#6366f1';
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size + 3, 0, Math.PI * 2);
          ctx.fill();
          ctx.shadowBlur = 0;
          return;
        }
        
        if (this.type === 'plasma') {
          ctx.strokeStyle = '#14b8a6';
          ctx.lineWidth = 2;
          ctx.globalAlpha = 0.4;
          
          if (this.trail.length > 1) {
            ctx.beginPath();
            ctx.moveTo(this.trail[0].x, this.trail[0].y);
            for (let i = 1; i < this.trail.length; i++) {
              ctx.lineTo(this.trail[i].x, this.trail[i].y);
            }
            ctx.stroke();
          }
          
          ctx.globalAlpha = 1;
          
          ctx.fillStyle = '#2dd4bf';
          ctx.shadowBlur = 15;
          ctx.shadowColor = '#14b8a6';
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size + 1, 0, Math.PI * 2);
          ctx.fill();
          ctx.shadowBlur = 0;
          return;
        }
        
        if (this.type === 'rocket') {
          ctx.fillStyle = '#ff4400';
          ctx.shadowBlur = 20;
          ctx.shadowColor = '#ff4400';
          
          ctx.save();
          ctx.translate(this.x, this.y);
          ctx.rotate(this.angle);
          ctx.fillRect(-this.size, -this.size/2, this.size * 2, this.size);
          ctx.restore();
          
          ctx.shadowBlur = 0;
          
          for (let i = 0; i < 2; i++) {
            particles.push(new Particle(this.x - Math.cos(this.angle) * 10, this.y - Math.sin(this.angle) * 10, 'rgb(255, 150, 0)'));
          }
          return;
        }
        
        ctx.strokeStyle = this.isPlayer ? 
          (this.type === 'sniper' ? '#22c55e' : (config.bullet_color || defaultConfig.bullet_color)) : 
          (config.enemy_color || defaultConfig.enemy_color);
        ctx.lineWidth = this.type === 'sniper' ? 3 : 2;
        ctx.globalAlpha = 0.3;
        
        if (this.trail.length > 1) {
          ctx.beginPath();
          ctx.moveTo(this.trail[0].x, this.trail[0].y);
          for (let i = 1; i < this.trail.length; i++) {
            ctx.lineTo(this.trail[i].x, this.trail[i].y);
          }
          ctx.stroke();
        }
        
        ctx.globalAlpha = 1;
        
        ctx.fillStyle = this.isPlayer ? 
          (this.type === 'sniper' ? '#22c55e' : (config.bullet_color || defaultConfig.bullet_color)) : 
          (config.enemy_color || defaultConfig.enemy_color);
        ctx.shadowBlur = this.type === 'sniper' ? 15 : 10;
        ctx.shadowColor = ctx.fillStyle;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
      }
    }
    
    function spawnEnemy() {
      if (!gameRunning) return;
      
      const enemiesPerSpawn = Math.min(1 + Math.floor(currentLevel / 3), 4);
      for (let i = 0; i < enemiesPerSpawn; i++) {
        enemies.push(new Enemy());
      }
      
      const difficulty = difficultySettings[currentDifficulty];
      const baseDelay = Math.max(400, 1200 - currentLevel * 50) * difficulty.spawnDelayMultiplier;
      const randomDelay = Math.random() * 300;
      spawnEnemyTimeout = setTimeout(spawnEnemy, baseDelay + randomDelay);
    }
    
    function showHitMarker(x, y) {
      const marker = document.createElement('div');
      marker.className = 'absolute hitmarker';
      marker.style.left = x + 'px';
      marker.style.top = y + 'px';
      marker.style.width = '30px';
      marker.style.height = '30px';
      marker.innerHTML = `
        <div class="absolute w-3 h-0.5 bg-white" style="left: 0; top: 50%; transform: translateY(-50%) rotate(45deg);"></div>
        <div class="absolute w-3 h-0.5 bg-white" style="right: 0; top: 50%; transform: translateY(-50%) rotate(-45deg);"></div>
        <div class="absolute w-0.5 h-3 bg-white" style="left: 50%; top: 0; transform: translateX(-50%) rotate(45deg);"></div>
        <div class="absolute w-0.5 h-3 bg-white" style="left: 50%; bottom: 0; transform: translateX(-50%) rotate(-45deg);"></div>
      `;
      document.getElementById('hitMarkers').appendChild(marker);
      setTimeout(() => marker.remove(), 300);
    }
    
    function checkCollisions() {
      const rect = canvas.getBoundingClientRect();
      
      bullets = bullets.filter(bullet => {
        if (bullet.isPlayer) {
          let hitSomething = false;
          
          if (bullet.type === 'rocket') {
            for (let i = enemies.length - 1; i >= 0; i--) {
              const enemy = enemies[i];
              const dx = bullet.x - enemy.x;
              const dy = bullet.y - enemy.y;
              const dist = Math.sqrt(dx * dx + dy * dy);
              
              if (dist < bullet.size + enemy.size) {
                explosions.push(new Explosion(bullet.x, bullet.y, 100));
                
                for (let j = 0; j < 30; j++) {
                  particles.push(new Particle(bullet.x, bullet.y, 'rgb(255, 100, 0)'));
                }
                
                enemies.forEach((e, idx) => {
                  const edx = bullet.x - e.x;
                  const edy = bullet.y - e.y;
                  const edist = Math.sqrt(edx * edx + edy * edy);
                  
                  if (edist < 100) {
                    let damageMultiplier = 1;
                    if (player && player.powerUps.damage > 0) {
                      damageMultiplier = 2;
                    }
                    
                    for (let d = 0; d < damageMultiplier; d++) {
                      if (e.takeDamage(1)) {
                        kills++;
                        currentGameCoins++;
                        
                        if (kills % 20 === 0) {
                          coins += 10;
                          currentGameCoins += 10;
                          
                          for (let k = 0; k < 50; k++) {
                            particles.push(new Particle(e.x, e.y, 'rgb(234, 179, 8)'));
                          }
                        }
                        
                        updateHUD();
                        enemies[idx] = null;
                        break;
                      }
                    }
                  }
                });
                
                enemies = enemies.filter(e => e !== null);
                
                return false;
              }
            }
          } else if (bullet.type === 'laser' || bullet.type === 'railgun') {
            for (let i = enemies.length - 1; i >= 0; i--) {
              const enemy = enemies[i];
              
              if (bullet.pierced.includes(enemy)) continue;
              
              const dx = bullet.x - enemy.x;
              const dy = bullet.y - enemy.y;
              const dist = Math.sqrt(dx * dx + dy * dy);
              
              if (dist < bullet.size + enemy.size) {
                bullet.pierced.push(enemy);
                hitSomething = true;
                
                let damageAmount = bullet.type === 'railgun' ? 999 : (bullet.damage || 1);
                let damageMultiplier = 1;
                if (player && player.powerUps.damage > 0) {
                  damageMultiplier = 2;
                }
                
                for (let d = 0; d < damageMultiplier; d++) {
                  if (enemy.takeDamage(damageAmount)) {
                    enemies.splice(i, 1);
                    kills++;
                    currentGameCoins++;
                    
                    if (kills % 20 === 0) {
                      coins += 10;
                      currentGameCoins += 10;
                      
                      for (let k = 0; k < 50; k++) {
                        particles.push(new Particle(enemy.x, enemy.y, 'rgb(234, 179, 8)'));
                      }
                    }
                    
                    updateHUD();
                    
                    for (let j = 0; j < 15; j++) {
                      particles.push(new Particle(enemy.x, enemy.y, 'rgb(239, 68, 68)'));
                    }
                    break;
                  }
                }
                
                const screenX = rect.left + (enemy.x / canvas.width) * rect.width;
                const screenY = rect.top + (enemy.y / canvas.height) * rect.height;
                showHitMarker(screenX, screenY);
              }
            }
            
            return true;
          } else {
            for (let i = enemies.length - 1; i >= 0; i--) {
              const enemy = enemies[i];
              const dx = bullet.x - enemy.x;
              const dy = bullet.y - enemy.y;
              const dist = Math.sqrt(dx * dx + dy * dy);
              
              if (dist < bullet.size + enemy.size) {
                let damageAmount = bullet.damage || 1;
                let damageMultiplier = 1;
                if (player && player.powerUps.damage > 0) {
                  damageMultiplier = 2;
                }
                
                for (let d = 0; d < damageMultiplier; d++) {
                  if (enemy.takeDamage(damageAmount)) {
                    enemies.splice(i, 1);
                    kills++;
                    currentGameCoins++;
                    
                    if (kills % 20 === 0) {
                      coins += 10;
                      currentGameCoins += 10;
                      
                      for (let k = 0; k < 50; k++) {
                        particles.push(new Particle(enemy.x, enemy.y, 'rgb(234, 179, 8)'));
                      }
                    }
                    
                    updateHUD();
                    
                    for (let j = 0; j < 15; j++) {
                      particles.push(new Particle(enemy.x, enemy.y, 'rgb(239, 68, 68)'));
                    }
                    break;
                  }
                }
                
                const screenX = rect.left + (enemy.x / canvas.width) * rect.width;
                const screenY = rect.top + (enemy.y / canvas.height) * rect.height;
                showHitMarker(screenX, screenY);
                
                return false;
              }
            }
          }
        } else {
          if (!player) return false;
          const dx = bullet.x - player.x;
          const dy = bullet.y - player.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          
          if (dist < bullet.size + player.size) {
            player.takeDamage(5);
            return false;
          }
        }
        return true;
      });
      
      enemies.forEach(enemy => {
        if (!player) return;
        const dx = enemy.x - player.x;
        const dy = enemy.y - player.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        
        if (dist < enemy.size + player.size) {
          player.takeDamage(enemy.damage || 5);
          enemy.health = 0;
        }
      });
      
      enemies = enemies.filter(e => e.health > 0);
      
      if (player) {
        healthPacks = healthPacks.filter(pack => {
          if (pack.checkCollision(player)) {
            player.heal(35);
            return false;
          }
          return true;
        });
        
        powerUps = powerUps.filter(powerUp => {
          if (powerUp.checkCollision(player)) {
            player.applyPowerUp(powerUp.type);
            return false;
          }
          return true;
        });
      }
    }
    
    function updateHUD() {
      document.getElementById('healthDisplay').textContent = Math.max(0, player.health);
      document.getElementById('healthFill').style.width = Math.max(0, player.health) + '%';
      document.getElementById('currentAmmo').textContent = player.ammo;
      document.getElementById('reserveAmmo').textContent = player.reserveAmmo;
      document.getElementById('killCount').textContent = kills;
      document.getElementById('levelDisplay').textContent = currentLevel;
      document.getElementById('coinDisplay').textContent = coins;
      document.getElementById('mainMenuCoins').textContent = coins;
      document.getElementById('shopCoinsDisplay').textContent = coins;
    }
    
    function updatePauseStats() {
      document.getElementById('pauseKills').textContent = kills;
      document.getElementById('pauseLevel').textContent = currentLevel;
      document.getElementById('pauseHealth').textContent = Math.max(0, player ? player.health : 0);
      document.getElementById('pauseCoins').textContent = coins;
    }
    
    function pauseGame() {
      gamePaused = true;
      gameRunning = false;
      updatePauseStats();
      document.getElementById('pauseMenuScreen').classList.remove('hidden');
    }
    
    function resumeGame() {
      gamePaused = false;
      gameRunning = true;
      document.getElementById('pauseMenuScreen').classList.add('hidden');
      gameLoop();
    }
    
    function gameLoop() {
      if (!gameRunning || gamePaused) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      
      ctx.fillStyle = config.background_color || defaultConfig.background_color;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      ctx.strokeStyle = 'rgba(148, 163, 184, 0.1)';
      ctx.lineWidth = 1;
      for (let i = 0; i < canvas.width; i += 60) {
        ctx.beginPath();
        ctx.moveTo(i, 0);
        ctx.lineTo(i, canvas.height);
        ctx.stroke();
      }
      for (let i = 0; i < canvas.height; i += 60) {
        ctx.beginPath();
        ctx.moveTo(0, i);
        ctx.lineTo(canvas.width, i);
        ctx.stroke();
      }
      
      particles = particles.filter(p => {
        const dead = p.update();
        if (!dead) p.draw();
        return !dead;
      });
      
      explosions = explosions.filter(exp => {
        const dead = exp.update();
        if (!dead) exp.draw();
        return !dead;
      });
      
      healthPacks = healthPacks.filter(pack => {
        const expired = pack.update();
        if (!expired) pack.draw();
        return !expired;
      });
      
      powerUps = powerUps.filter(powerUp => {
        const expired = powerUp.update();
        if (!expired) powerUp.draw();
        return !expired;
      });
      
      if (player) {
        player.update();
        player.draw();
      }
      
      enemies.forEach(enemy => {
        enemy.update();
        enemy.draw();
      });
      
      bullets = bullets.filter(bullet => {
        const outOfBounds = bullet.update();
        if (!outOfBounds) bullet.draw();
        return !outOfBounds;
      });
      
      checkCollisions();
      
      requestAnimationFrame(gameLoop);
    }
    
    function showUpgradeScreen() {
      gameRunning = false;
      enemies = [];
      bullets = [];
      
      const weaponSelection = document.getElementById('weaponSelection');
      weaponSelection.innerHTML = '';
      
      const weaponConfigs = [
        { id: 'assault', name: 'ëŒê²© ì†Œì´', desc: 'ê· í˜• ì¡íŒ ì„±ëŠ¥', ammo: '30ë°œ', speed: 'ë³´í†µ', bgStyle: 'background: linear-gradient(135deg, #164e63 0%, #083344 100%);', borderColor: '#22d3ee', textColor: '#22d3ee' },
        { id: 'shotgun', name: 'ì‚°íƒ„ì´', desc: 'ê°•ë ¥í•œ ê·¼ê±°ë¦¬ í™”ë ¥', ammo: '8ë°œ', speed: 'ëŠë¦¼', bgStyle: 'background: linear-gradient(135deg, #7f1d1d 0%, #450a0a 100%);', borderColor: '#ef4444', textColor: '#ef4444' },
        { id: 'smg', name: 'ê¸°ê´€ë‹¨ì´', desc: 'ë¹ ë¥¸ ì—°ì‚¬ ì†ë„', ammo: '40ë°œ', speed: 'ë§¤ìš° ë¹ ë¦„', bgStyle: 'background: linear-gradient(135deg, #713f12 0%, #451a03 100%);', borderColor: '#fbbf24', textColor: '#fbbf24' },
        { id: 'doubleshot', name: '2ì—°ë°œ ì´', desc: 'í•œ ë²ˆì— 2ë°œ ë°œì‚¬!', ammo: '20ë°œ', speed: 'ë³´í†µ', bgStyle: 'background: linear-gradient(135deg, #831843 0%, #500724 100%);', borderColor: '#ec4899', textColor: '#ec4899' },
        { id: 'tripleshot', name: '3ì—°ë°œ ì´', desc: 'í•œ ë²ˆì— 3ë°œ ë°œì‚¬!', ammo: '18ë°œ', speed: 'ë³´í†µ', bgStyle: 'background: linear-gradient(135deg, #581c87 0%, #3b0764 100%);', borderColor: '#a855f7', textColor: '#a855f7' },
        { id: 'sniper', name: 'ì €ê²©ì´', desc: '5ë°° ë°ë¯¸ì§€!', ammo: '5ë°œ', speed: 'ë§¤ìš° ëŠë¦¼', bgStyle: 'background: linear-gradient(135deg, #14532d 0%, #052e16 100%);', borderColor: '#22c55e', textColor: '#22c55e' },
        { id: 'burst', name: 'ì ì‚¬ì´', desc: '3ë°œ ë¹ ë¥¸ ì ì‚¬', ammo: '24ë°œ', speed: 'ë¹ ë¦„', bgStyle: 'background: linear-gradient(135deg, #1e3a8a 0%, #1e3a8a 100%);', borderColor: '#3b82f6', textColor: '#3b82f6' },
        { id: 'minigun', name: 'ë¯¸ë‹ˆê±´', desc: 'ì´ˆê³ ì† ì—°ì‚¬!', ammo: '100ë°œ', speed: 'ë§¤ìš° ë¹ ë¦„', bgStyle: 'background: linear-gradient(135deg, #7c2d12 0%, #431407 100%);', borderColor: '#f97316', textColor: '#f97316' },
        { id: 'laser', name: 'ë ˆì´ì €ê±´', desc: 'ê´€í†µ ë ˆì´ì €!', ammo: '30ë°œ', speed: 'ë³´í†µ', bgStyle: 'background: linear-gradient(135deg, #064e3b 0%, #022c22 100%);', borderColor: '#10b981', textColor: '#10b981' },
        { id: 'rocket', name: 'ë¡œì¼“ ëŸ°ì²˜', desc: 'í­ë°œ ë²”ìœ„ ê³µê²©!', ammo: '4ë°œ', speed: 'ëŠë¦¼', bgStyle: 'background: linear-gradient(135deg, #881337 0%, #4c0519 100%);', borderColor: '#f43f5e', textColor: '#f43f5e' },
        { id: 'railgun', name: 'ë ˆì¼ê±´', desc: 'ì¦‰ì‚¬ ê´€í†µíƒ„!', ammo: '3ë°œ', speed: 'ë§¤ìš° ëŠë¦¼', bgStyle: 'background: linear-gradient(135deg, #3730a3 0%, #1e1b4b 100%);', borderColor: '#6366f1', textColor: '#6366f1' },
        { id: 'plasma', name: 'í”Œë¼ì¦ˆë§ˆì´', desc: 'ì—ë„ˆì§€ ì—°ì‚¬!', ammo: '35ë°œ', speed: 'ë¹ ë¦„', bgStyle: 'background: linear-gradient(135deg, #115e59 0%, #042f2e 100%);', borderColor: '#14b8a6', textColor: '#14b8a6' }
      ];
      
      const unlockedConfigs = weaponConfigs.filter(weapon => unlockedWeapons.includes(weapon.id));
      
      unlockedConfigs.forEach(weapon => {
        const btn = document.createElement('button');
        btn.className = 'upgrade-btn pointer-events-auto cursor-pointer p-6 rounded-xl border-2 transition-all duration-300 hover:scale-105';
        btn.style.cssText = weapon.bgStyle + ` border-color: ${weapon.borderColor};`;
        btn.setAttribute('data-weapon', weapon.id);
        btn.innerHTML = `
          <div style="color: ${weapon.textColor};" class="text-3xl font-bold mb-2">${weapon.name}</div>
          <div class="text-white text-base mb-2">${weapon.desc}</div>
          <div class="text-gray-300 text-sm">íƒ„ì°½: ${weapon.ammo}</div>
          <div class="text-gray-300 text-sm">ì—°ì‚¬ ì†ë„: ${weapon.speed}</div>
        `;
        weaponSelection.appendChild(btn);
      });
      
      document.querySelectorAll('.upgrade-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const weaponType = btn.getAttribute('data-weapon');
          upgradeWeapon(weaponType);
        });
      });
      
      document.getElementById('upgradeScreen').classList.remove('hidden');
    }
    
    function hideUpgradeScreen() {
      document.getElementById('upgradeScreen').classList.add('hidden');
      gameRunning = true;
      spawnEnemy();
      gameLoop();
    }
    
    function upgradeWeapon(weaponType) {
      if (player) {
        player.setWeapon(weaponType);
        currentLevel++;
        updateHUD();
        hideUpgradeScreen();
      }
    }
    
    function getDifficultyName(difficulty) {
      if (difficulty === 'easy') return 'ğŸ˜Š ì´ì§€';
      if (difficulty === 'normal') return 'ğŸ˜ ë³´í†µ';
      if (difficulty === 'hard') return 'ğŸ˜ˆ í•˜ë“œ';
      return 'ğŸ˜ ë³´í†µ';
    }
    
    function displayRankings() {
      const rankingsList = document.getElementById('rankingsList');
      const currentRankings = allRankings.filter(r => r.difficulty === currentDifficulty);
      
      currentRankings.sort((a, b) => {
        if (b.kills !== a.kills) return b.kills - a.kills;
        return b.level - a.level;
      });
      
      if (currentRankings.length === 0) {
        rankingsList.innerHTML = '<div class="text-gray-400 text-center py-4 text-lg">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }
      
      let html = '';
      currentRankings.slice(0, 10).forEach((rank, index) => {
        const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}.`;
        const diffBadge = getDifficultyName(rank.difficulty || currentDifficulty);
        const isCurrentPlayer = rank.name === currentPlayerName;
        const deleteBtn = isCurrentPlayer && rank.__backendId ? 
          `<button class="delete-rank-btn pointer-events-auto cursor-pointer bg-red-600 hover:bg-red-500 text-white px-3 py-1 rounded text-sm ml-3 transition-all" data-rank-id="${rank.__backendId}">ì‚­ì œ</button>` : '';
        html += `
          <div class="flex justify-between items-center py-3 px-4 mb-2 bg-gray-800 bg-opacity-50 rounded ${index < 3 ? 'border border-yellow-600' : ''}">
            <div class="flex items-center gap-3">
              <span class="text-2xl w-10">${medal}</span>
              <span class="text-white text-xl font-bold">${rank.name}</span>
              <span class="text-gray-400 text-sm">${diffBadge}</span>
              ${deleteBtn}
            </div>
            <div class="flex gap-6">
              <span class="text-yellow-400 text-lg">${rank.kills} ì²˜ì¹˜</span>
              <span class="text-green-400 text-lg">Lv.${rank.level}</span>
            </div>
          </div>
        `;
      });
      rankingsList.innerHTML = html;
      
      document.querySelectorAll('.delete-rank-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.preventDefault();
          const rankId = btn.getAttribute('data-rank-id');
          const rankToDelete = allRankings.find(r => r.__backendId === rankId);
          
          if (rankToDelete && window.dataSdk && dataInitialized) {
            btn.disabled = true;
            btn.textContent = 'ì‚­ì œ ì¤‘...';
            const result = await window.dataSdk.delete(rankToDelete);
            if (!result.isOk) {
              btn.disabled = false;
              btn.textContent = 'ì‚­ì œ';
            }
          }
        });
      });
    }
    
    let viewingDifficulty = 'easy';
    
    function displayMainRankings(difficulty) {
      const rankingsList = document.getElementById('mainRankingsList');
      const currentRankings = allRankings.filter(r => r.difficulty === difficulty);
      
      currentRankings.sort((a, b) => {
        if (b.kills !== a.kills) return b.kills - a.kills;
        return b.level - a.level;
      });
      
      if (currentRankings.length === 0) {
        rankingsList.innerHTML = '<div class="text-gray-400 text-center py-4 text-lg">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }
      
      let html = '';
      currentRankings.slice(0, 10).forEach((rank, index) => {
        const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}.`;
        const diffBadge = getDifficultyName(rank.difficulty || difficulty);
        html += `
          <div class="flex justify-between items-center py-3 px-4 mb-2 bg-gray-800 bg-opacity-50 rounded ${index < 3 ? 'border border-yellow-600' : ''}">
            <div class="flex items-center gap-3">
              <span class="text-2xl w-10">${medal}</span>
              <span class="text-white text-xl font-bold">${rank.name}</span>
              <span class="text-gray-400 text-sm">${diffBadge}</span>
            </div>
            <div class="flex gap-6">
              <span class="text-yellow-400 text-lg">${rank.kills} ì²˜ì¹˜</span>
              <span class="text-green-400 text-lg">Lv.${rank.level}</span>
            </div>
          </div>
        `;
      });
      rankingsList.innerHTML = html;
    }
    
    async function saveScore(replaceExisting = false) {
      if (!window.dataSdk || !dataInitialized) return;
      
      const nameInput = document.getElementById('playerNameInput');
      const playerName = nameInput.value.trim() || 'ë¬´ëª…ì˜ ì „ì‚¬';
      currentPlayerName = playerName;
      
      const currentRankings = allRankings.filter(r => r.difficulty === currentDifficulty);
      const existingRecord = currentRankings.find(r => r.name === playerName);
      
      if (existingRecord && !replaceExisting) {
        document.getElementById('duplicateNameWarning').classList.remove('hidden');
        return;
      }
      
      document.getElementById('duplicateNameWarning').classList.add('hidden');
      
      const saveBtn = document.getElementById('saveScoreBtn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'ì €ì¥ ì¤‘...';
      
      if (replaceExisting && existingRecord && existingRecord.__backendId) {
        await window.dataSdk.delete(existingRecord);
      }
      
      const newRecord = {
        name: playerName,
        kills: kills,
        level: currentLevel,
        difficulty: currentDifficulty,
        date: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(newRecord);
      
      if (result.isOk) {
        nameInput.value = '';
      } else {
        saveBtn.disabled = false;
        saveBtn.textContent = 'ê¸°ë¡ ì €ì¥';
      }
    }
    
    function startGame() {
      gameRunning = true;
      kills = 0;
      currentLevel = 1;
      enemies = [];
      bullets = [];
      particles = [];
      healthPacks = [];
      powerUps = [];
      explosions = [];
      player = new Player();
      currentPlayerName = '';
      
      updateHUD();
      detectMobile();
      
      if (spawnEnemyTimeout) {
        clearTimeout(spawnEnemyTimeout);
      }
      
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('gameOver').classList.add('hidden');
      document.getElementById('upgradeScreen').classList.add('hidden');
      document.getElementById('duplicateNameWarning').classList.add('hidden');
      document.getElementById('weaponShopScreen').classList.add('hidden');
      
      setTimeout(spawnEnemy, 1000);
      gameLoop();
    }
    
    function endGame() {
      gameRunning = false;
      document.getElementById('mobileControls').classList.add('hidden');
      
      document.getElementById('finalKills').textContent = kills;
      
      const difficultyBadge = document.getElementById('difficultyBadge');
      if (currentDifficulty === 'easy') {
        difficultyBadge.textContent = 'ğŸ˜Š ì´ì§€ ëª¨ë“œ';
        difficultyBadge.className = 'inline-block px-6 py-2 rounded-full text-xl font-bold mb-3 bg-green-600 text-white';
      } else if (currentDifficulty === 'normal') {
        difficultyBadge.textContent = 'ğŸ˜ ë³´í†µ ëª¨ë“œ';
        difficultyBadge.className = 'inline-block px-6 py-2 rounded-full text-xl font-bold mb-3 bg-cyan-600 text-white';
      } else if (currentDifficulty === 'hard') {
        difficultyBadge.textContent = 'ğŸ˜ˆ í•˜ë“œ ëª¨ë“œ';
        difficultyBadge.className = 'inline-block px-6 py-2 rounded-full text-xl font-bold mb-3 bg-red-600 text-white';
      }
      
      const saveBtn = document.getElementById('saveScoreBtn');
      saveBtn.disabled = false;
      saveBtn.textContent = 'ê¸°ë¡ ì €ì¥';
      
      displayRankings();
      document.getElementById('gameOver').classList.remove('hidden');
    }
    
    function backToHome() {
      document.getElementById('gameOver').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
      document.getElementById('mainMenuCoins').textContent = coins;
    }
    
    canvas.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      mouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
      mouseY = (e.clientY - rect.top) * (canvas.height / rect.height);
    });
    
    canvas.addEventListener('mousedown', () => {
      mouseDown = true;
    });
    
    canvas.addEventListener('mouseup', () => {
      mouseDown = false;
    });
    
    canvas.addEventListener('mouseleave', () => {
      mouseDown = false;
    });
    
    document.addEventListener('keydown', (e) => {
      keys[e.key] = true;
      
      if ((e.key === 'r' || e.key === 'R') && gameRunning && player) {
        player.reload();
      }
    });
    
    document.addEventListener('keyup', (e) => {
      keys[e.key] = false;
    });
    
    function handleJoystickTouch(joystick, base, knob, touch, rect) {
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      let dx = touch.clientX - centerX;
      let dy = touch.clientY - centerY;
      
      const maxRadius = rect.width / 2 - 32;
      const distance = Math.sqrt(dx * dx + dy * dy);
      
      if (distance > maxRadius) {
        dx = (dx / distance) * maxRadius;
        dy = (dy / distance) * maxRadius;
      }
      
      joystick.x = dx / maxRadius;
      joystick.y = dy / maxRadius;
      
      knob.style.left = `50%`;
      knob.style.top = `50%`;
      knob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
    }
    
    function resetJoystick(joystick, knob) {
      joystick.active = false;
      joystick.x = 0;
      joystick.y = 0;
      joystick.identifier = null;
      joystick.shooting = false;
      knob.style.transform = 'translate(-50%, -50%)';
    }
    
    const leftJoystickBase = document.getElementById('leftJoystickBase');
    const leftJoystickKnob = document.getElementById('leftJoystickKnob');
    const rightJoystickBase = document.getElementById('rightJoystickBase');
    const rightJoystickKnob = document.getElementById('rightJoystickKnob');
    
    leftJoystickBase.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (!leftJoystick.active && gameRunning) {
        const touch = e.changedTouches[0];
        leftJoystick.active = true;
        leftJoystick.identifier = touch.identifier;
        const rect = leftJoystickBase.getBoundingClientRect();
        handleJoystickTouch(leftJoystick, leftJoystickBase, leftJoystickKnob, touch, rect);
      }
    });
    
    leftJoystickBase.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (leftJoystick.active && gameRunning) {
        for (let touch of e.changedTouches) {
          if (touch.identifier === leftJoystick.identifier) {
            const rect = leftJoystickBase.getBoundingClientRect();
            handleJoystickTouch(leftJoystick, leftJoystickBase, leftJoystickKnob, touch, rect);
            break;
          }
        }
      }
    });
    
    leftJoystickBase.addEventListener('touchend', (e) => {
      e.preventDefault();
      for (let touch of e.changedTouches) {
        if (touch.identifier === leftJoystick.identifier) {
          resetJoystick(leftJoystick, leftJoystickKnob);
          break;
        }
      }
    });
    
    rightJoystickBase.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (!rightJoystick.active && gameRunning) {
        const touch = e.changedTouches[0];
        rightJoystick.active = true;
        rightJoystick.identifier = touch.identifier;
        rightJoystick.shooting = true;
        const rect = rightJoystickBase.getBoundingClientRect();
        handleJoystickTouch(rightJoystick, rightJoystickBase, rightJoystickKnob, touch, rect);
      }
    });
    
    rightJoystickBase.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (rightJoystick.active && gameRunning) {
        for (let touch of e.changedTouches) {
          if (touch.identifier === rightJoystick.identifier) {
            const rect = rightJoystickBase.getBoundingClientRect();
            handleJoystickTouch(rightJoystick, rightJoystickBase, rightJoystickKnob, touch, rect);
            break;
          }
        }
      }
    });
    
    rightJoystickBase.addEventListener('touchend', (e) => {
      e.preventDefault();
      for (let touch of e.changedTouches) {
        if (touch.identifier === rightJoystick.identifier) {
          resetJoystick(rightJoystick, rightJoystickKnob);
          break;
        }
      }
    });
    
    document.getElementById('mobileReloadBtn').addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (player && gameRunning) {
        player.reload();
      }
    });
    
    document.getElementById('restartBtn').addEventListener('click', (e) => {
      e.preventDefault();
      startGame();
    });
    
    document.getElementById('backToHomeBtn').addEventListener('click', (e) => {
      e.preventDefault();
      backToHome();
    });
    
    document.getElementById('startGameBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('difficultyScreen').classList.remove('hidden');
    });
    
    document.getElementById('easyModeBtn').addEventListener('click', (e) => {
      e.preventDefault();
      currentDifficulty = 'easy';
      document.getElementById('difficultyScreen').classList.add('hidden');
      startGame();
    });
    
    document.getElementById('normalModeBtn').addEventListener('click', (e) => {
      e.preventDefault();
      currentDifficulty = 'normal';
      document.getElementById('difficultyScreen').classList.add('hidden');
      startGame();
    });
    
    document.getElementById('hardModeBtn').addEventListener('click', (e) => {
      e.preventDefault();
      currentDifficulty = 'hard';
      document.getElementById('difficultyScreen').classList.add('hidden');
      startGame();
    });
    
    document.getElementById('backFromDifficultyBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('difficultyScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
    });
    
    document.getElementById('saveScoreBtn').addEventListener('click', (e) => {
      e.preventDefault();
      saveScore(false);
    });
    
    document.getElementById('updateRecordBtn').addEventListener('click', (e) => {
      e.preventDefault();
      saveScore(true);
    });
    
    document.getElementById('keepBothBtn').addEventListener('click', async (e) => {
      e.preventDefault();
      document.getElementById('duplicateNameWarning').classList.add('hidden');
      
      if (!window.dataSdk || !dataInitialized) return;
      
      const nameInput = document.getElementById('playerNameInput');
      const playerName = nameInput.value.trim() || 'ë¬´ëª…ì˜ ì „ì‚¬';
      currentPlayerName = playerName;
      
      const saveBtn = document.getElementById('saveScoreBtn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'ì €ì¥ ì¤‘...';
      
      const newRecord = {
        name: playerName,
        kills: kills,
        level: currentLevel,
        difficulty: currentDifficulty,
        date: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(newRecord);
      
      if (result.isOk) {
        nameInput.value = '';
      } else {
        saveBtn.disabled = false;
        saveBtn.textContent = 'ê¸°ë¡ ì €ì¥';
      }
    });
    
    function updateShopDisplay() {
      document.getElementById('shopCoinsDisplay').textContent = coins;
      document.getElementById('mainMenuCoins').textContent = coins;
      
      document.querySelectorAll('.buy-weapon-btn').forEach(btn => {
        const weapon = btn.getAttribute('data-weapon');
        const cost = parseInt(btn.getAttribute('data-cost'));
        const item = btn.closest('.weapon-shop-item');
        const overlay = item.querySelector('.locked-overlay');
        
        if (unlockedWeapons.includes(weapon)) {
          btn.disabled = true;
          btn.textContent = 'êµ¬ë§¤ ì™„ë£Œ';
          btn.classList.remove('bg-green-600', 'hover:bg-green-500');
          btn.classList.add('bg-gray-600');
          overlay.classList.remove('hidden');
        } else if (coins < cost) {
          btn.disabled = true;
          btn.classList.remove('bg-green-600', 'hover:bg-green-500');
          btn.classList.add('bg-gray-600');
        } else {
          btn.disabled = false;
          btn.classList.remove('bg-gray-600');
          btn.classList.add('bg-green-600', 'hover:bg-green-500');
        }
      });
    }
    
    document.getElementById('weaponShopBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('weaponShopScreen').classList.remove('hidden');
      updateShopDisplay();
    });
    
    document.getElementById('closeShopBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('weaponShopScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
    });
    
    document.querySelectorAll('.buy-weapon-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const weapon = btn.getAttribute('data-weapon');
        const cost = parseInt(btn.getAttribute('data-cost'));
        
        if (coins >= cost && !unlockedWeapons.includes(weapon)) {
          coins -= cost;
          
          unlockedWeapons.push(weapon);
          
          updateShopDisplay();
        }
      });
    });
    
    const previewCanvas = document.getElementById('previewCanvas');
    const previewCtx = previewCanvas.getContext('2d');
    
    document.getElementById('mainMenuCoins').textContent = coins;
    
    function drawPreviewCharacter() {
      previewCtx.fillStyle = '#0f172a';
      previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);
      
      const centerX = previewCanvas.width / 2;
      const centerY = previewCanvas.height / 2;
      const size = 50;
      const angle = 0;
      
      previewCtx.save();
      previewCtx.translate(centerX, centerY);
      previewCtx.rotate(angle);
      
      previewCtx.fillStyle = playerCustomization.mainColor;
      previewCtx.shadowBlur = 20;
      previewCtx.shadowColor = playerCustomization.mainColor;
      previewCtx.beginPath();
      previewCtx.moveTo(size * 1.2, 0);
      previewCtx.lineTo(size * 0.5, size * 0.6);
      previewCtx.lineTo(-size * 0.8, size * 0.6);
      previewCtx.lineTo(-size * 1.2, 0);
      previewCtx.lineTo(-size * 0.8, -size * 0.6);
      previewCtx.lineTo(size * 0.5, -size * 0.6);
      previewCtx.closePath();
      previewCtx.fill();
      
      previewCtx.shadowBlur = 0;
      previewCtx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
      previewCtx.lineWidth = 3;
      previewCtx.stroke();
      
      previewCtx.fillStyle = playerCustomization.secondaryColor;
      previewCtx.beginPath();
      previewCtx.arc(-size * 0.5, 0, size * 0.4, 0, Math.PI * 2);
      previewCtx.fill();
      
      previewCtx.fillStyle = playerCustomization.mainColor;
      previewCtx.globalAlpha = 0.8;
      previewCtx.beginPath();
      previewCtx.arc(-size * 0.5, 0, size * 0.25, 0, Math.PI * 2);
      previewCtx.fill();
      previewCtx.globalAlpha = 1;
      
      previewCtx.fillStyle = playerCustomization.secondaryColor;
      previewCtx.beginPath();
      previewCtx.ellipse(size * 0.2, -size * 0.5, size * 0.3, size * 0.2, 0, 0, Math.PI * 2);
      previewCtx.fill();
      previewCtx.beginPath();
      previewCtx.ellipse(size * 0.2, size * 0.5, size * 0.3, size * 0.2, 0, 0, Math.PI * 2);
      previewCtx.fill();
      
      previewCtx.fillStyle = playerCustomization.secondaryColor;
      previewCtx.fillRect(size * 0.8, -10, 48, 20);
      
      previewCtx.fillStyle = playerCustomization.secondaryColor;
      previewCtx.fillRect(size * 0.5, -6, 20, 12);
      
      previewCtx.fillStyle = '#0f172a';
      previewCtx.fillRect(size * 0.8 + 48, -6, 12, 12);
      
      previewCtx.fillStyle = '#94a3b8';
      previewCtx.fillRect(size * 0.8 + 16, -16, 16, 6);
      
      previewCtx.fillStyle = playerCustomization.mainColor;
      previewCtx.fillRect(size * 0.8 + 4, -8, 36, 4);
      
      previewCtx.restore();
    }
    
    document.getElementById('customizeBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('customizeScreen').classList.remove('hidden');
      drawPreviewCharacter();
    });
    
    document.querySelectorAll('.color-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const color = btn.getAttribute('data-color');
        const type = btn.getAttribute('data-type');
        
        document.querySelectorAll(`.color-btn[data-type="${type}"]`).forEach(b => {
          b.classList.remove('border-white');
          b.classList.add('border-gray-600');
        });
        btn.classList.remove('border-gray-600');
        btn.classList.add('border-white');
        
        if (type === 'main') {
          playerCustomization.mainColor = color;
        } else if (type === 'secondary') {
          playerCustomization.secondaryColor = color;
        }
        
        drawPreviewCharacter();
      });
    });
    
    document.getElementById('saveCustomizationBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('customizeScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
    });
    
    document.getElementById('backToMenuBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('customizeScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
    });
    
    document.getElementById('viewRankingsBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('rankingsScreen').classList.remove('hidden');
      viewingDifficulty = 'easy';
      displayMainRankings(viewingDifficulty);
      updateDifficultyTabs();
    });
    
    document.getElementById('backFromRankingsBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('rankingsScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
    });
    
    function updateDifficultyTabs() {
      document.querySelectorAll('.difficulty-tab').forEach(tab => {
        tab.classList.remove('bg-green-600', 'bg-cyan-600', 'bg-red-600', 'border-green-400', 'border-cyan-400', 'border-red-400', 'text-white');
        tab.classList.add('bg-gray-700', 'border-gray-600', 'text-gray-300');
      });
      
      if (viewingDifficulty === 'easy') {
        document.getElementById('easyTab').classList.remove('bg-gray-700', 'border-gray-600', 'text-gray-300');
        document.getElementById('easyTab').classList.add('bg-green-600', 'border-green-400', 'text-white');
      } else if (viewingDifficulty === 'normal') {
        document.getElementById('normalTab').classList.remove('bg-gray-700', 'border-gray-600', 'text-gray-300');
        document.getElementById('normalTab').classList.add('bg-cyan-600', 'border-cyan-400', 'text-white');
      } else if (viewingDifficulty === 'hard') {
        document.getElementById('hardTab').classList.remove('bg-gray-700', 'border-gray-600', 'text-gray-300');
        document.getElementById('hardTab').classList.add('bg-red-600', 'border-red-400', 'text-white');
      }
    }
    
    document.getElementById('easyTab').addEventListener('click', (e) => {
      e.preventDefault();
      viewingDifficulty = 'easy';
      displayMainRankings(viewingDifficulty);
      updateDifficultyTabs();
    });
    
    document.getElementById('normalTab').addEventListener('click', (e) => {
      e.preventDefault();
      viewingDifficulty = 'normal';
      displayMainRankings(viewingDifficulty);
      updateDifficultyTabs();
    });
    
    document.getElementById('hardTab').addEventListener('click', (e) => {
      e.preventDefault();
      viewingDifficulty = 'hard';
      displayMainRankings(viewingDifficulty);
      updateDifficultyTabs();
    });
    
    document.getElementById('pauseBtn').addEventListener('click', (e) => {
      e.preventDefault();
      if (gameRunning && !gamePaused) {
        pauseGame();
      }
    });
    
    document.getElementById('resumeBtn').addEventListener('click', (e) => {
      e.preventDefault();
      resumeGame();
    });
    
    document.getElementById('restartFromPauseBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('pauseMenuScreen').classList.add('hidden');
      gamePaused = false;
      startGame();
    });
    
    document.getElementById('homeFromPauseBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('pauseMenuScreen').classList.add('hidden');
      gamePaused = false;
      gameRunning = false;
      if (spawnEnemyTimeout) {
        clearTimeout(spawnEnemyTimeout);
      }
      document.getElementById('startScreen').classList.remove('hidden');
      document.getElementById('mainMenuCoins').textContent = coins;
    });
    
    async function onConfigChange(config) {
      const titleElement = document.getElementById('gameTitle');
      if (titleElement) {
        titleElement.textContent = config.game_title || defaultConfig.game_title;
      }
      
      const controlsElement = document.getElementById('controlsText');
      if (controlsElement) {
        controlsElement.textContent = config.controls_guide || defaultConfig.controls_guide;
      }
    }
    
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: defaultConfig,
        onConfigChange: onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.player_color || defaultConfig.player_color,
              set: (value) => {
                config.player_color = value;
                window.elementSdk.setConfig({ player_color: value });
              }
            },
            {
              get: () => config.enemy_color || defaultConfig.enemy_color,
              set: (value) => {
                config.enemy_color = value;
                window.elementSdk.setConfig({ enemy_color: value });
              }
            },
            {
              get: () => config.bullet_color || defaultConfig.bullet_color,
              set: (value) => {
                config.bullet_color = value;
                window.elementSdk.setConfig({ bullet_color: value });
              }
            },
            {
              get: () => config.ui_accent || defaultConfig.ui_accent,
              set: (value) => {
                config.ui_accent = value;
                window.elementSdk.setConfig({ ui_accent: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["controls_guide", config.controls_guide || defaultConfig.controls_guide]
        ])
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9afb47e7f080ea91',t:'MTc2NjAyNTQ3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>